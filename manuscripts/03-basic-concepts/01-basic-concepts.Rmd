class: inverse, middle, center

# Basic concepts illustrated using a two-level factor (pp.3--8)

---

class: inverse, middle
<!-- class: inverse, middle, split-50 -->

## 1要因2水準の実験で，応答変数の平均値を比較

1. シミュレーション用データを作成
2. シミュレーションの結果を図や表で確認
3. シミュレーション用データに対し線形モデルを構築
    - とりあえず線形モデルを作るとどうなるか試す
4. Default contrast coding: treatment contrasts
5. Defining hypotheses
6. Sum contrast
7. Cell means parameterization

---

::::: block

### シミュレーション用データを作成

- [`mixedDesign()`](http://read.psych.uni-potsdam.de/attachments/article/188/mixedDesign.v0.6.3.R)を使う
- 1要因2水準
    1. F1: 0.8秒
    1. F2: 0.4秒
- 実験参加者数10人
  - 被験者間計画 (between-subject design)
  - 実験参加者は，F1の条件だけ，またはF2の条件だけに接する
    1. F1: 5人
    1. F2: 5人

:::::

---

<!--
https://stackoverflow.com/questions/67750561/vertically-scrollable-code-with-rstudio-and-xaringan
-->

`r chunk_reveal("simdat")`

<!--
#### the number of between-subject factors
-->

```{r simdat, include = FALSE}
mixedDesign(
  #### 被験者間計画での水準数 ####
  B = 2,
  #### 被験者内計画での水準数 ####
  W = NULL,
  #### 被験者間計画での1水準あたりの実験参加者数 ####
  #### 実験参加者総数は，`B * n` ####
  n = 5,
  #### 水準ごとの応答変数の平均を示した行列 ####
  #### 各行に水準ごとの応答変数の平均を入れる ####
  M = matrix(
    c(0.8, 0.4),
    nrow = 2,
    ncol = 1,
    byrow = FALSE
  ),
  #### 要因の標準偏差 ####
  SD = 0.20,
  #### 「1試行1データ」の整然データでデータフレームを作成 ####
  long = TRUE
) |>
  rename(F = B_A) |>
  mutate(
    F = fct_recode(
      F,
      F1 = "A1",
      F2 = "A2"
    )
  ) ->
  simdat

str(simdat)
```

---

::::: block

### シミュレーションの結果を図や表で確認

- 1要因2水準
    1. F1: 0.8秒（標準偏差0.2秒）
    1. F2: 0.4秒（標準偏差0.2秒）

:::::

---

`r chunk_reveal("fig-simdat")`

```{r fig-simdat, include = FALSE}
simdat  |>
  group_by(F) |>
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |>
  ungroup() |>
  (
    \(d){
      qplot(
        x = F, y = M,
        group = 1,
        data = d,
        geom = c("point", "line")
      )
    }
  )() +
  geom_errorbar(
    aes(
      max = M + SE,
      min = M - SE
    ),
    width = 0
  ) +
  labs(
    y = "Mean DV",
    x = "Factor F"
  )
```

---

`r chunk_reveal("tab-simdat")`

```{r tab-simdat, include = FALSE}
simdat  |>
  group_by(F) |>
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |>
  ungroup() |>
  kable(
    digits = 2,
    col.names = c(
      'Levels of Factor',
      'N. of data points',
      'Mean RT',
      'Std. Dev.',
      'Std. Err.'
    )
  )
```

---

::: columns

:::: pull-left

::::: block

### シミュレーション用データに対し線形モデルを構築

- 水準間で応答変数の平均が有意に異なるか，線形モデルで確認

```{r lm-simdat, include = TRUE}
lm(DV ~ F, simdat) ->
  m_F
```

- 切片 (intercept, `r m_F |> tidy() |> filter(term == "(Intercept)") |> pull(estimate)`)
  - F1の下での応答変数の平均 $\hat{{\mu}_1}$
- 傾き (intercept, `r m_F |> tidy() |> filter(term == "FF2") |> pull(estimate)`)
  - F2の下での応答変数の平均とF1の下での応答変数の平均の差 $\hat{{\mu}_2} - \hat{{\mu}_1}$


:::::

::::

:::: pull-right

```{r tab-lm-simdat, ref.label=c('tab-lm-simdat', 'fig-simdat'), echo = FALSE, eval = TRUE}
```

::::

:::

---

::: columns

:::: pull-left

::::: block

### シミュレーション用データに対し線形モデルを構築

- 95%信頼区間 (95% Confidence Interval)
  - 平均値 $\pm `r qnorm(0.975) |> round(3)` \times \text{標準誤差 (Standanrd Error)}$
  - 「100回実験して95回は真値を含むような区間」
- $t$ 値
  - この $t$ 値は，自由度が $(\text{（その水準から得られたデータポイント数）}-1) \times 2$ の $t$ 分布に従う
  - この $t$ 分布の両側2.5%の範囲にあれば，有意
  - $(5-1) \times 2 = `r (5-1) * 2`$ なので，今回の $t$ 値は， $t(`r (5-1) * 2`)$ に従う
  - $t(`r (5-1) * 2`)$ の両側2.5%の範囲は， $t \leq `r qt(0.025, df = (5-1) * 2) |> abs() |> round(2)`, `r qt(0.975, df = (5-1) * 2) |> abs() |> round(2)` \leq t$
  - $t$ 値が上記区間に入っていれば，有意

:::::

::::

:::: pull-right

```{r tab-lm-simdat, ref.label=c('tab-lm-simdat', 'fig-simdat'), echo = FALSE, eval = TRUE}
```

::::

:::

---

`r chunk_reveal("tab-lm-simdat")`

```{r tab-lm-simdat, include = FALSE}
m_F |>
  tidy(
    conf.int = TRUE,
    conf.level = 0.95
  ) |>
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |> round(3),
      ", ",
      conf.high |> round(3),
      "]"
    )
  ) |>
  relocate(
    `95% CI`, .after = estimate
  ) |>
  dplyr::select(
    -c(
      std.error,
      conf.low,
      conf.high
    )
  ) |>
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```

---

::: columns

:::: pull-left

::::: block

### Default contrast coding: treatment contrasts

- 切片 (intercept, `r m_F |> tidy() |> filter(term == "(Intercept)") |> pull(estimate)`)
  - F1の下での応答変数の平均 $\hat{{\mu}_1}$
- 傾き (intercept, `r m_F |> tidy() |> filter(term == "FF2") |> pull(estimate)`)
  - F2の下での応答変数の平均とF1の下での応答変数の平均の差 $\hat{{\mu}_2} - \hat{{\mu}_1}$

なぜ，切片と傾きがこの値になるのか？？

--

$\because$ デフォルトでは，Rは，名義尺度に[treatment contrast](#treatment-contrast)を適用するため

:::::

::::

:::: pull-right


```{r lm-simdat-2, ref.label=c('lm-simdat'), echo = TRUE, eval = FALSE}
```
```{r fig-simdat-2, ref.label=c('fig-simdat'), echo = FALSE, eval = TRUE}
```

::::

:::

---

`r chunk_reveal("treatment-simdat")`

```{r treatment-simdat, include = FALSE}
simdat$F |>
  contrasts()
```

---

::: columns

:::: pull-left

::::: block

### Default contrast coding: treatment contrasts

Rがデフォルトで名義尺度に適用する対比

$$
x =
\begin{cases}
0 & \text{F1 のとき} \\
1 & \text{F2 のとき}
\end{cases}
$$

```{r lm-simdat-2, ref.label=c('treatment-simdat'), echo = TRUE, eval = TRUE}
```


$$
\overbrace{y}^{\text{応答変数}} = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x
$$

:::::

::::

:::: pull-right


::::

:::

---

<!--
5. Defining hypotheses
6. Sum contrast
7. Cell means parameterization
-->
