<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Schad et al (2020)に学ぶ名義尺度のコーディング</title>
    <meta charset="utf-8" />
    <meta name="author" content="小川雅貴" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/hygge.css" rel="stylesheet" />
    <link href="libs/remark-css/ninjutsu.css" rel="stylesheet" />
    <link href="libs/remark-css/robot.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Schad et al (2020)に学ぶ名義尺度のコーディング
## Schad et al (2020)日本語注解
### 小川雅貴
### 東京大学
### 2021/12/17 (updated: 2021-12-15)

---





class: middle center hide-slide-number





.info-box.w-50.bg-white.f3[
このHTMLスライドをご覧になる際は，
ChromeまたはFirefoxをお使いになることをお勧めいたします。
また，HTMLスライドの中身が正しく読み込まれない場合には，
ブラウザの更新ボタンを押して，再度スライドを読み込んでください。
なお，本スライドのPDF版は
&lt;a href=https://htmlpreview.github.io/?https://github.com/CLRafaelR/factor_coding/blob/main/Notes-Schad-et-al-2020.html&gt;こちら&lt;i class="fas fa-file-pdf"&gt;&lt;/i&gt;&lt;/a&gt;
にございます。
]

&lt;br&gt;

.white[**右矢印➝**を押すと次のスライドに移ります]

---
class: inverse, middle, center


# 必要なパッケージ・関数の読み込み

&lt;!-- get a flipbook version of the my_cars code chunk - pauses are where parentheses are balanced --&gt;
---

count: false
 

.panel1-load-packages-sources-auto[

```r
*library(tidyverse)
```
]
 
.panel2-load-packages-sources-auto[
次のパッケージ群を呼び出す  
- **ggplot2**: データ可視化・図生成  
- **dplyr**: データ操作  
- **tidyr**: データ整然化  
- **readr**: データ読み込み  
- **purrr**: 関数型プログラミング  
- **tibble**: 現代的データフレームtibbles  
- **stringr**: 文字列処理  
- **forcats**: カテゴリ変数の操作
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
*library(broom)
```
]
 
.panel2-load-packages-sources-auto[
統計モデルの解析結果をtibbleで表示
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
*library(lme4)
```
]
 
.panel2-load-packages-sources-auto[
一般化線形混合モデルの構築
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
*library(MASS)
```
]
 
.panel2-load-packages-sources-auto[
対比行列の構築
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
library(MASS)
*library(hypr)
```
]
 
.panel2-load-packages-sources-auto[
「仮説」行列の構築
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
library(MASS)
library(hypr)
*library(knitr)
```
]
 
.panel2-load-packages-sources-auto[
Rでの動的文書生成
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
library(MASS)
library(hypr)
library(knitr)

*source(
* "http://read.psych.uni-potsdam.de/attachments/article/188/mixedDesign.v0.6.3.R",
* local = knitr::knit_global()
*) 
```
]
 
.panel2-load-packages-sources-auto[
mixedDesign()の読み込み  
  
Rmarkdownをknitする際には，**source()**の項で**local = knitr::knit_global()**を指定する  
https://bookdown.org/yihui/rmarkdown-cookbook/source-script.html
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
library(MASS)
library(hypr)
library(knitr)

source(
  "http://read.psych.uni-potsdam.de/attachments/article/188/mixedDesign.v0.6.3.R",
  local = knitr::knit_global()
)

*#source("http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R")  #source("http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R")
```
]
 
.panel2-load-packages-sources-auto[
Schad et al (2020)の元コードは[こちら](http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R)
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
library(MASS)
library(hypr)
library(knitr)

source(
  "http://read.psych.uni-potsdam.de/attachments/article/188/mixedDesign.v0.6.3.R",
  local = knitr::knit_global()
)

#source("http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R")  #source("http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R")

*set.seed(1212)
```
]
 
.panel2-load-packages-sources-auto[
乱数の固定
]

---
count: false
 

.panel1-load-packages-sources-auto[

```r
library(tidyverse)
library(broom)
library(lme4)
library(MASS)
library(hypr)
library(knitr)

source(
  "http://read.psych.uni-potsdam.de/attachments/article/188/mixedDesign.v0.6.3.R",
  local = knitr::knit_global()
)

#source("http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R")  #source("http://read.psych.uni-potsdam.de/pmr2/attachments/article/188/SchadEtAlJML2019.R")

set.seed(1212)

*options(
* scipen = 999,
* digits = 2
* )
```
]
 
.panel2-load-packages-sources-auto[
指数表記の回避・有効数字2桁に設定
]

&lt;style&gt;
.panel1-load-packages-sources-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-load-packages-sources-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-load-packages-sources-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



&lt;!--
Rmarkdownをknitする際には，\`source()\`の項\`local = knitr::knit_global()\`を指定する"
--&gt;





---


class: inverse, middle, center

# Conceptual explanation of default contrasts (p.3)

.footnote[以下，各対比の和訳は[R commanderにおける和訳](https://r-forge.r-project.org/scm/viewvc.php/pkg/po/R-ja.po?view=markup&amp;revision=98&amp;root=rcmdr&amp;pathrev=235)に基づく]

---


class: split-50

name: treatment-contrast

## Treatment contrast 処理対比

::: columns

:::: pull-left

- 実験的介入treatmentの効果を，非介入群との比較で検討
  - 実験群 vs 統制群
- 各実験群を同一の統制群と比べる

--

- 例：様々なプライミング効果を，同一の統制群と比べる
    2. 綴字プライミング
    1. 音韻的プライミング
    3. プライミングなし（統制群）

--

  - 対比は次の2つ
      1. 綴字プライミング vs プライミングなし（統制群）
      2. 音韻的プライミング vs プライミングなし（統制群）

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-treatment-contrasts-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

.footnote[dummy contrastとも呼ばれる]

---


class: split-50

## Sum contrast 零和対比

::: columns

:::: pull-left

- 実験的介入treatmentの効果を，全ての群の平均との比較で検討
  - 実験群 vs 全体平均

--

- 例：様々なプライミング効果を，全体平均と比べる
    1. 音韻的プライミング
    2. 綴字プライミング
    3. 意味プライミング

--

  - 対比は次の2つ
      1. 音韻的プライミング vs 全体平均
      2. 綴字プライミング vs 全体平均

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-sum-contrasts-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::


---


class: split-50

## Repeated contrast

::: columns

:::: pull-left

- （順序が決まっている）隣り合う水準同士を比較
  - 実験群1 vs 実験群2
  - 実験群2 vs 実験群3...

--

- 例：語の頻度の効果を，隣り合う水準と比べる
    1. 低頻度
    2. 中頻度
    3. 高頻度

--

  - 対比は次の2つ
      1. 中頻度 vs 低頻度
      2. 高頻度 vs 中頻度

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-repeated-contrasts-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::


---


class: split-50

## Polynomial contrast 多項式対比

::: columns

:::: pull-left

- （順序と間隔が決まっている）隣り合う水準間の増減傾向を比較
  - 水準間で同じペースで増加・減少？
  - 水準間毎に，増加・減少のペースが変わる？

--

- 例：語の頻度の効果を，隣り合う水準と比べる
    1. 低頻度
    2. 中頻度
    3. 高頻度

--

  - 対比は次の2つ
      1. 1次関数ペース（Linear; どの水準間でも一定ペースで増加・減少？）
      2. 2次関数ペース（Quadratic; 次の水準間に移るほど増加・減少が激しい・穏やか？）

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-polynomial-contrasts-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

.footnote[[*This type of coding system should be used only with an ordinal variable in which the levels are equally spaced*](https://stats.idre.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/#:~:text=This%20type%20of%20coding%20system%20should%20be%20used%20only%20with%20an%20ordinal%20variable%20in%20which%20the%20levels%20are%20equally%20spaced)]


---


class: split-50

## Helmert contrast ヘルマート対比

::: columns

:::: pull-left

- 「1つの水準を残りの水準の平均と比較する」ことを繰り返す
  - 水準1 vs 残りの水準（水準2と水準3の平均）
  - 水準2 vs 残りの水準（水準3）

--

- 例：様々なプライミング効果を，種類ごとに比べる
    1. 無効なプライミング1
    2. 無効なプライミング2
    3. 有効なプライミング

--

  - 対比は次の2つ
      1. 無効なプライミング1 vs 無効なプライミング2
      2. 無効なプライミング vs 有効なプライミング

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-helmert-contrasts-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

---


class: inverse, middle, center

# Basic concepts illustrated using a two-level factor (pp.3--8)

---

class: inverse, middle
&lt;!-- class: inverse, middle, split-50 --&gt;

## 1要因2水準の実験で，応答変数の平均値を比較

1. シミュレーション用データを作成
2. シミュレーションの結果を図や表で確認
3. シミュレーション用データに対し線形モデルを構築
    - とりあえず線形モデルを作るとどうなるか試す
4. Default contrast coding: treatment contrasts
5. Defining hypotheses
6. Sum contrast
7. Cell means parameterization

---

::::: block

### シミュレーション用データを作成

- [`mixedDesign()`](http://read.psych.uni-potsdam.de/attachments/article/188/mixedDesign.v0.6.3.R)を使う
- 1要因2水準
    1. F1: 0.8秒
    1. F2: 0.4秒
- 実験参加者数10人
  - 被験者間計画 (between-subject design)
  - 実験参加者は，F1の条件だけ，またはF2の条件だけに接する
    1. F1: 5人
    1. F2: 5人

:::::

---

&lt;!--
https://stackoverflow.com/questions/67750561/vertically-scrollable-code-with-rstudio-and-xaringan
--&gt;

count: false
 
### シミュレーション用データを作成
.panel1-simdat-auto[

```r
*set.seed(1212); simdat &lt;- mixedDesign(
* B = 2,
* W = NULL,
* n = 5,
* M = matrix(
*   c(0.8, 0.4),
*   nrow = 2,
*   ncol = 1,
*   byrow = FALSE
* ),
* SD = 0.20,
* long = TRUE
*) 
```
]
 
.panel2-simdat-auto[

]
 
.panel3-simdat-auto[
データフレーム作成  
- **B**：被験者間計画での水準数，  
- **W**：被験者内計画での水準数，  
- **n**：被験者間計画での1水準あたりの実験参加者数，  
  - 実験参加者総数は，**B * n**  
- **M**：水準ごとの応答変数の平均を示した行列  
  - 各行に水準ごとの応答変数の平均を入れる  
- **SD**：要因の標準偏差  
- **long**：「1試行1データ」の整然データでデータフレームを作成
]

---
count: false
 
### シミュレーション用データを作成
.panel1-simdat-auto[

```r
set.seed(1212); simdat &lt;- mixedDesign(
  B = 2,
  W = NULL,
  n = 5,
  M = matrix(
    c(0.8, 0.4),
    nrow = 2,
    ncol = 1,
    byrow = FALSE
  ),
  SD = 0.20,
  long = TRUE
) |&gt;
* rename(F = B_A)
```
]
 
.panel2-simdat-auto[

]
 
.panel3-simdat-auto[
要因名をB_AからFに変更
]

---
count: false
 
### シミュレーション用データを作成
.panel1-simdat-auto[

```r
set.seed(1212); simdat &lt;- mixedDesign(
  B = 2,
  W = NULL,
  n = 5,
  M = matrix(
    c(0.8, 0.4),
    nrow = 2,
    ncol = 1,
    byrow = FALSE
  ),
  SD = 0.20,
  long = TRUE
) |&gt;
  rename(F = B_A) |&gt;
* mutate(
*   F = fct_recode(
*     F,
*     F1 = "A1",
*     F2 = "A2"
*   )
* )
```
]
 
.panel2-simdat-auto[

]
 
.panel3-simdat-auto[
水準名をA\*からF\*に変更
]

---
count: false
 
### シミュレーション用データを作成
.panel1-simdat-auto[

```r
set.seed(1212); simdat &lt;- mixedDesign(
  B = 2,
  W = NULL,
  n = 5,
  M = matrix(
    c(0.8, 0.4),
    nrow = 2,
    ncol = 1,
    byrow = FALSE
  ),
  SD = 0.20,
  long = TRUE
) |&gt;
  rename(F = B_A) |&gt;
  mutate(
    F = fct_recode(
      F,
      F1 = "A1",
      F2 = "A2"
    )
  )

*str(simdat)
```
]
 
.panel2-simdat-auto[

```
'data.frame':	10 obs. of  3 variables:
 $ F : Factor w/ 2 levels "F1","F2": 1 1 1 1 1 2 2 2 2 2
 $ id: Factor w/ 10 levels "1","2","3","4",..: 1 2 3 4 5 6 7 8 9 10
 $ DV: num  0.737 0.554 0.963 1.044 0.701 ...
```
]
 
.panel3-simdat-auto[
データフレームの中身の詳細を表示
]

&lt;style&gt;
.panel1-simdat-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-simdat-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-simdat-auto {
  color: black;
  width: 19.4%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::::: block

### シミュレーションの結果を図や表で確認

- 1要因2水準
    1. F1: 0.8秒（標準偏差0.2秒）
    1. F2: 0.4秒（標準偏差0.2秒）

:::::

---

count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
*simdat
```
]
 
.panel2-fig-simdat-auto[

```
    F id   DV
1  F1  1 0.74
2  F1  2 0.55
3  F1  3 0.96
4  F1  4 1.04
5  F1  5 0.70
6  F2  6 0.26
7  F2  7 0.39
8  F2  8 0.17
9  F2  9 0.48
10 F2 10 0.69
```
]
 
.panel3-fig-simdat-auto[
データセット
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
simdat |&gt;
* group_by(F)
```
]
 
.panel2-fig-simdat-auto[

```
# A tibble: 10 x 3
# Groups:   F [2]
   F     id       DV
   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
 1 F1    1     0.737
 2 F1    2     0.554
 3 F1    3     0.963
 4 F1    4     1.04 
 5 F1    5     0.701
 6 F2    6     0.262
 7 F2    7     0.395
 8 F2    8     0.173
 9 F2    9     0.483
10 F2    10    0.687
```
]
 
.panel3-fig-simdat-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
* summarise(
*   N = length(DV),
*   M = mean(DV),
*   SD = sd(DV),
*   SE = SD / sqrt(N)
* )
```
]
 
.panel2-fig-simdat-auto[

```
# A tibble: 2 x 5
  F         N     M    SD     SE
  &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 F1        5   0.8   0.2 0.0894
2 F2        5   0.4   0.2 0.0894
```
]
 
.panel3-fig-simdat-auto[
水準毎に，  
- データの個数**N**，  
- 応答変数の平均値**M**，  
- 応答変数の平均値の標準偏差**SD**，  
- 応答変数の平均値の標準偏差**SE**  
  
を計算
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
* ungroup()
```
]
 
.panel2-fig-simdat-auto[

```
# A tibble: 2 x 5
  F         N     M    SD     SE
  &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 F1        5   0.8   0.2 0.0894
2 F2        5   0.4   0.2 0.0894
```
]
 
.panel3-fig-simdat-auto[
まとめ上げを解除
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
* (
*   \(d){
*     qplot(
*       x = F, y = M,
*       group = 1,
*       data = d,
*       geom = c("point", "line")
*     )
*   }
* )()
```
]
 
.panel2-fig-simdat-auto[
&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat_auto_05_output-1.png" width="576" style="display: block; margin: auto;" /&gt;
]
 
.panel3-fig-simdat-auto[
線グラフを描画
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
  (
    \(d){
      qplot(
        x = F, y = M,
        group = 1,
        data = d,
        geom = c("point", "line")
      )
    }
  )() +
* geom_errorbar(
*   aes(
*     max = M + SE,
*     min = M - SE
*   ),
*   width = 0
* )
```
]
 
.panel2-fig-simdat-auto[
&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat_auto_06_output-1.png" width="576" style="display: block; margin: auto;" /&gt;
]
 
.panel3-fig-simdat-auto[
誤差範囲 ( `\(\pm 1SE\)` ) を描画  
※ `\(\pm 1SE\)` 自体は95%信頼区間ではない（68%信頼区間）  
※信頼区間にする場合， `\(\pm 1.96SE\)` 
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
  (
    \(d){
      qplot(
        x = F, y = M,
        group = 1,
        data = d,
        geom = c("point", "line")
      )
    }
  )() +
  geom_errorbar(
    aes(
      max = M + SE,
      min = M - SE
    ),
    width = 0
  ) +
* labs(
*   y = "Mean DV",
*   x = "Factor F"
* )
```
]
 
.panel2-fig-simdat-auto[
&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat_auto_07_output-1.png" width="576" style="display: block; margin: auto;" /&gt;
]
 
.panel3-fig-simdat-auto[
x軸・y軸の軸名を変更
]

&lt;style&gt;
.panel1-fig-simdat-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-fig-simdat-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-fig-simdat-auto {
  color: black;
  width: 19.4%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat-auto[

```r
*simdat
```
]
 
.panel2-tab-simdat-auto[

```
    F id   DV
1  F1  1 0.74
2  F1  2 0.55
3  F1  3 0.96
4  F1  4 1.04
5  F1  5 0.70
6  F2  6 0.26
7  F2  7 0.39
8  F2  8 0.17
9  F2  9 0.48
10 F2 10 0.69
```
]
 
.panel3-tab-simdat-auto[
データセット
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat-auto[

```r
simdat |&gt;
* group_by(F)
```
]
 
.panel2-tab-simdat-auto[

```
# A tibble: 10 x 3
# Groups:   F [2]
   F     id       DV
   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
 1 F1    1     0.737
 2 F1    2     0.554
 3 F1    3     0.963
 4 F1    4     1.04 
 5 F1    5     0.701
 6 F2    6     0.262
 7 F2    7     0.395
 8 F2    8     0.173
 9 F2    9     0.483
10 F2    10    0.687
```
]
 
.panel3-tab-simdat-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
* summarise(
*   N = length(DV),
*   M = mean(DV),
*   SD = sd(DV),
*   SE = SD / sqrt(N)
* )
```
]
 
.panel2-tab-simdat-auto[

```
# A tibble: 2 x 5
  F         N     M    SD     SE
  &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 F1        5   0.8   0.2 0.0894
2 F2        5   0.4   0.2 0.0894
```
]
 
.panel3-tab-simdat-auto[
水準毎に，  
- データの個数**N**，  
- 応答変数の平均値**M**，  
- 応答変数の平均値の標準偏差**SD**，  
- 応答変数の平均値の標準偏差**SE**  
  
を計算
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
* ungroup()
```
]
 
.panel2-tab-simdat-auto[

```
# A tibble: 2 x 5
  F         N     M    SD     SE
  &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 F1        5   0.8   0.2 0.0894
2 F2        5   0.4   0.2 0.0894
```
]
 
.panel3-tab-simdat-auto[
まとめ上げを解除
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat-auto[

```r
simdat |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
* kable(
*   digits = 2,
*   col.names = c(
*     'Levels of Factor',
*     'N. of data points',
*     'Mean RT',
*     'Std. Dev.',
*     'Std. Err.'
*   )
* )
```
]
 
.panel2-tab-simdat-auto[

|Levels of Factor | N. of data points| Mean RT| Std. Dev.| Std. Err.|
|:----------------|-----------------:|-------:|---------:|---------:|
|F1               |                 5|     0.8|       0.2|      0.09|
|F2               |                 5|     0.4|       0.2|      0.09|
]
 
.panel3-tab-simdat-auto[
表の出力  
- **digits**：有効数字の桁数を指定  
- **col.names**：表内での各列の名前を変更
]

&lt;style&gt;
.panel1-tab-simdat-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-tab-simdat-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-tab-simdat-auto {
  color: black;
  width: 19.4%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::: columns

:::: pull-left

::::: block

### シミュレーション用データに対し線形モデルを構築

- 水準間で応答変数の平均が有意に異なるか，線形モデルで確認


```r
m_F &lt;- lm(DV ~ F, simdat)
```

- 切片 (intercept, 0.8)
  - F1の下での応答変数の平均 `\(\widehat{{\mu}_{\text{F1}}}\)`
- 傾き (intercept, -0.4)
  - F2の下での応答変数の平均とF1の下での応答変数の平均の差 `\(\widehat{{\mu}_{\text{F2}}} - \widehat{{\mu}_{\text{F1}}}\)`


:::::

::::

:::: pull-right


|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      0.8|[0.594, 1.006]   |       8.9|      0.00|
|FF2         |     -0.4|[-0.692, -0.108] |      -3.2|      0.01|

&lt;img src="figures/Notes-Schad-etal-2020-tab-lm-simdat2-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

::: columns

:::: pull-left

::::: block

### シミュレーション用データに対し線形モデルを構築

- 95%信頼区間 (95% Confidence Interval)
  - 平均値 `\(\pm 1.96 \times \text{標準誤差 (Standanrd Error)}\)`
  - 「100回実験して95回は真値を含むような区間」
- `\(t\)` 値
  - この `\(t\)` 値は，自由度が `\((\text{（その水準から得られたデータポイント数）}-1) \times 2\)` の `\(t\)` 分布に従う
  - この `\(t\)` 分布の両側2.5%の範囲にあれば，有意
  - `\((5-1) \times 2 = 8\)` なので，今回の `\(t\)` 値は， `\(t(8)\)` に従う
  - `\(t(8)\)` の両側2.5%の範囲は， `\(t \leq 2.31, 2.31 \leq t\)`
  - `\(t\)` 値が上記区間に入っていれば，有意

:::::

::::

:::: pull-right


|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      0.8|[0.594, 1.006]   |       8.9|      0.00|
|FF2         |     -0.4|[-0.692, -0.108] |      -3.2|      0.01|

&lt;img src="figures/Notes-Schad-etal-2020-tab-lm-simdat-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

count: false
 

.panel1-tab-lm-simdat-auto[

```r
*m_F
```
]
 
.panel2-tab-lm-simdat-auto[

```

Call:
lm(formula = DV ~ F, data = simdat)

Coefficients:
(Intercept)          FF2  
        0.8         -0.4  
```
]

---
count: false
 

.panel1-tab-lm-simdat-auto[

```r
m_F |&gt;
* tidy(
*   conf.int = TRUE,
*   conf.level = 0.95
* )
```
]
 
.panel2-tab-lm-simdat-auto[

```
# A tibble: 2 x 7
  term        estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)      0.8    0.0894      8.94 0.0000194    0.594     1.01 
2 FF2             -0.4    0.126      -3.16 0.0133      -0.692    -0.108
```
]

---
count: false
 

.panel1-tab-lm-simdat-auto[

```r
m_F |&gt;
  tidy(
    conf.int = TRUE,
    conf.level = 0.95
  ) |&gt;
* mutate(
*   `95% CI` = paste0(
*     "[",
*     conf.low |&gt; round(3),
*     ", ",
*     conf.high |&gt; round(3),
*     "]"
*   )
* )
```
]
 
.panel2-tab-lm-simdat-auto[

```
# A tibble: 2 x 8
  term        estimate std.error statistic   p.value conf.low conf.high `95% CI`
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   
1 (Intercept)      0.8    0.0894      8.94 0.0000194    0.594     1.01  [0.594,~
2 FF2             -0.4    0.126      -3.16 0.0133      -0.692    -0.108 [-0.692~
```
]

---
count: false
 

.panel1-tab-lm-simdat-auto[

```r
m_F |&gt;
  tidy(
    conf.int = TRUE,
    conf.level = 0.95
  ) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(3),
      ", ",
      conf.high |&gt; round(3),
      "]"
    )
  ) |&gt;
* relocate(
*   `95% CI`, .after = estimate
* )
```
]
 
.panel2-tab-lm-simdat-auto[

```
# A tibble: 2 x 8
  term        estimate `95% CI`   std.error statistic p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)      0.8 [0.594, 1~    0.0894      8.94 1.94e-5    0.594     1.01 
2 FF2             -0.4 [-0.692, ~    0.126      -3.16 1.33e-2   -0.692    -0.108
```
]

---
count: false
 

.panel1-tab-lm-simdat-auto[

```r
m_F |&gt;
  tidy(
    conf.int = TRUE,
    conf.level = 0.95
  ) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(3),
      ", ",
      conf.high |&gt; round(3),
      "]"
    )
  ) |&gt;
  relocate(
    `95% CI`, .after = estimate
  ) |&gt;
* dplyr::select(
*   -c(
*     std.error,
*     conf.low,
*     conf.high
*   )
* )
```
]
 
.panel2-tab-lm-simdat-auto[

```
# A tibble: 2 x 5
  term        estimate `95% CI`         statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)      0.8 [0.594, 1.006]        8.94 0.0000194
2 FF2             -0.4 [-0.692, -0.108]     -3.16 0.0133   
```
]

---
count: false
 

.panel1-tab-lm-simdat-auto[

```r
m_F |&gt;
  tidy(
    conf.int = TRUE,
    conf.level = 0.95
  ) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(3),
      ", ",
      conf.high |&gt; round(3),
      "]"
    )
  ) |&gt;
  relocate(
    `95% CI`, .after = estimate
  ) |&gt;
  dplyr::select(
    -c(
      std.error,
      conf.low,
      conf.high
    )
  ) |&gt;
* kable(
*   digits = 2,
*   escape = FALSE,
*   col.names = c(
*     'Predictor',
*     'Estimate',
*     '95% CI',
*     '$t$-value',
*     '$p$-value'
*   )
* )
```
]
 
.panel2-tab-lm-simdat-auto[

|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      0.8|[0.594, 1.006]   |       8.9|      0.00|
|FF2         |     -0.4|[-0.692, -0.108] |      -3.2|      0.01|
]

&lt;style&gt;
.panel1-tab-lm-simdat-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-tab-lm-simdat-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-tab-lm-simdat-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::: columns

:::: pull-left

::::: block

### Default contrast coding: treatment contrasts

- 切片 (intercept, 0.8)
  - F1の下での応答変数の平均 `\(\widehat{{\mu}_{\text{F1}}}\)`
- 傾き (intercept, -0.4)
  - F2の下での応答変数の平均とF1の下での応答変数の平均の差 `\(\widehat{{\mu}_{\text{F2}}} - \widehat{{\mu}_{\text{F1}}}\)`

なぜ，切片と傾きがこの値になるのか？？

--

`\(\because\)` デフォルトでは，Rは，名義尺度に[treatment contrast](#treatment-contrast)を適用するため

:::::

::::

:::: pull-right



```r
m_F &lt;- lm(DV ~ F, simdat)
```
&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat-2-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

count: false
 
### Treatment contrastsとその意味
.panel1-treatment-simdat-auto[

```r
*contrasts(simdat$F)
```
]
 
.panel2-treatment-simdat-auto[

```
   F2
F1  0
F2  1
```
]
 
.panel3-treatment-simdat-auto[
`$$x = \begin{cases} 0 &amp; \text{F1 のとき} \\ 1 &amp; \text{F2 のとき} \end{cases}$$`
]

&lt;style&gt;
.panel1-treatment-simdat-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-treatment-simdat-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-treatment-simdat-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::: columns

:::: pull-left

::::: block

### Default contrast coding: treatment contrasts

Rがデフォルトで名義尺度に適用する対比

`$$x =
\begin{cases}
0 &amp; \text{F1 のとき} \\
1 &amp; \text{F2 のとき}
\end{cases}$$`





`$$\therefore \begin{align}\overbrace{y}^{\text{応答変数}} &amp; = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x\\
&amp; =
\begin{cases}
{\beta}_0 + {\beta}_1 \times 0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 \times 1 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
{\beta}_0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.8 &amp; \text{F1 のとき}\\
0.8 + (-0.4) &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.8 &amp; \text{F1 のとき}\\
0.4 &amp; \text{F2 のとき}
\end{cases}\end{align}$$`

:::::

::::

:::: pull-right

&lt;!--

`$$\begin{align}\overbrace{y}^{\text{応答変数}} &amp; = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x\\
&amp; =
\begin{cases}
{\beta}_0 + {\beta}_1 \times 0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 \times 1 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
{\beta}_0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 &amp; \text{F2 のとき}
\end{cases}\end{align}$$`

--&gt;

&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat-2-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

::::: block

### Defining hypotheses

Treatment contrastの下では，

- 傾き `\({\beta}_1\)`
  - 「実験条件の応答変数の平均値」と「統制条件での応答変数の平均値」の差
  - ( `\({\mu}_{\text{F2}} - {\mu}_{\text{F1}}\)` )
- 切片 `\({\beta}_0\)`
  - 統制条件での応答変数の平均値
  - ( `\({\mu}_{\text{F1}}\)` )

--

↑切片や傾きの意味を言語化しただけ

--

**切片や傾きを通じて，どのような帰無仮説を棄却しようとしているのか？**

:::::

---

::::: block

#### 傾き `\({\beta}_1\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：傾きが存在しない

--

`\(H_0: {\beta}_1 = 0\)`

--

`\(H_0: {\mu}_{\text{F2}} - {\mu}_{\text{F1}} = 0\)`

:::::


::::: block

#### 切片 `\({\beta}_0\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：切片が存在しない

--

`\(H_0: {\beta}_0 = 0\)`

--

`\(H_0: {\mu}_{\text{F1}} = 0\)`

:::::

---

#### 統制条件とする水準を変えるには

- Rは，水準をアルファベット順に読み込み，アルファベット順に数値（0,1）を付与する
- アルファベット順に関係なく，特定の水準を統制条件としたい場合には
  
---

count: false
 
#### 統制条件とする水準を変えるには
.panel1-recode-simdat-auto[

```r
*simdat &lt;- simdat

simdat
```
]
 
.panel2-recode-simdat-auto[

```
    F id   DV
1  F1  1 0.74
2  F1  2 0.55
3  F1  3 0.96
4  F1  4 1.04
5  F1  5 0.70
6  F2  6 0.26
7  F2  7 0.39
8  F2  8 0.17
9  F2  9 0.48
10 F2 10 0.69
```
]

---
count: false
 
#### 統制条件とする水準を変えるには
.panel1-recode-simdat-auto[

```r
simdat &lt;- simdat |&gt;
* mutate(
*   Fb = fct_relevel(
*     F,
*     "F2",
*     "F1"
*   )
* )

simdat
```
]
 
.panel2-recode-simdat-auto[

```
    F id   DV Fb
1  F1  1 0.74 F1
2  F1  2 0.55 F1
3  F1  3 0.96 F1
4  F1  4 1.04 F1
5  F1  5 0.70 F1
6  F2  6 0.26 F2
7  F2  7 0.39 F2
8  F2  8 0.17 F2
9  F2  9 0.48 F2
10 F2 10 0.69 F2
```
]

---
count: false
 
#### 統制条件とする水準を変えるには
.panel1-recode-simdat-auto[

```r
simdat &lt;- simdat |&gt;
  mutate(
    Fb = fct_relevel(
      F,
      "F2",
      "F1"
    )
  )

*contrasts(simdat$Fb)

simdat
```
]
 
.panel2-recode-simdat-auto[

```
   F1
F2  0
F1  1
```

```
    F id   DV Fb
1  F1  1 0.74 F1
2  F1  2 0.55 F1
3  F1  3 0.96 F1
4  F1  4 1.04 F1
5  F1  5 0.70 F1
6  F2  6 0.26 F2
7  F2  7 0.39 F2
8  F2  8 0.17 F2
9  F2  9 0.48 F2
10 F2 10 0.69 F2
```
]

---
count: false
 
#### 統制条件とする水準を変えるには
.panel1-recode-simdat-auto[

```r
simdat &lt;- simdat |&gt;
  mutate(
    Fb = fct_relevel(
      F,
      "F2",
      "F1"
    )
  )

contrasts(simdat$Fb)

*contrasts(simdat$F)

simdat
```
]
 
.panel2-recode-simdat-auto[

```
   F1
F2  0
F1  1
```

```
   F2
F1  0
F2  1
```

```
    F id   DV Fb
1  F1  1 0.74 F1
2  F1  2 0.55 F1
3  F1  3 0.96 F1
4  F1  4 1.04 F1
5  F1  5 0.70 F1
6  F2  6 0.26 F2
7  F2  7 0.39 F2
8  F2  8 0.17 F2
9  F2  9 0.48 F2
10 F2 10 0.69 F2
```
]

&lt;style&gt;
.panel1-recode-simdat-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-recode-simdat-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-recode-simdat-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::: columns

:::: pull-left

**F2を統制条件にした場合**


```r
m1_mr &lt;- lm(DV ~ Fb, simdat)
```


|Predictor   | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------------|---------:|---------:|
|(Intercept) |      0.4|[0.194, 0.606] |       4.5|      0.00|
|FbF1        |      0.4|[0.108, 0.692] |       3.2|      0.01|

`$$x =
\begin{cases}
0 &amp; \text{F2 のとき} \\
1 &amp; \text{F1 のとき}
\end{cases}$$`

`$$\therefore\begin{align}
%\overbrace{y}^{\text{応答変数}} &amp; = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x\\
y &amp; = {\beta}_0 + {\beta}_1 x\\
&amp; =
\begin{cases}
{\beta}_0 + {\beta}_1 \times 0 &amp; \text{F2 のとき}\\
{\beta}_0 + {\beta}_1 \times 1 &amp; \text{F1 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.4 &amp; \text{F2 のとき}\\
0.4 + (0.4) &amp; \text{F1 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.4 &amp; \text{F2 のとき}\\
0.8 &amp; \text{F1 のとき}
\end{cases}\end{align}$$`

::::

:::: pull-right

F1が統制条件である場合


```r
m_F &lt;- lm(DV ~ F, simdat)
```


|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      0.8|[0.594, 1.006]   |       8.9|      0.00|
|FF2         |     -0.4|[-0.692, -0.108] |      -3.2|      0.01|

`$$x =
\begin{cases}
0 &amp; \text{F1 のとき} \\
1 &amp; \text{F2 のとき}
\end{cases}$$`

`$$\therefore \begin{align}
%\overbrace{y}^{\text{応答変数}} &amp; = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x\\
y &amp; = {\beta}_0 + {\beta}_1 x\\
&amp; =
\begin{cases}
{\beta}_0 + {\beta}_1 \times 0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 \times 1 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.8 &amp; \text{F1 のとき}\\
0.8 + (-0.4) &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.8 &amp; \text{F1 のとき}\\
0.4 &amp; \text{F2 のとき}
\end{cases}\end{align}$$`

::::

:::

---

::: columns

:::: pull-left

::::: block

### F2を統制条件にした場合

#### 傾き `\({\beta}_1\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：傾きが存在しない

--

`\(H_0: {\beta}_1 = 0\)`

--

`\(H_0: {\mu}_{\text{F1}} - {\mu}_{\text{F2}} = 0\)`

:::::


::::: block

#### 切片 `\({\beta}_0\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：切片が存在しない

--

`\(H_0: {\beta}_0 = 0\)`

--

`\(H_0: {\mu}_{\text{F2}} = 0\)`

:::::

::::

:::: pull-right

::::: block

### （参考）F1が統制条件である場合

#### 傾き `\({\beta}_1\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：傾きが存在しない

`\(H_0: {\beta}_1 = 0\)`

`\(H_0: {\mu}_{\text{F2}} - {\mu}_{\text{F1}} = 0\)`

:::::


::::: block

#### 切片 `\({\beta}_0\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：切片が存在しない

`\(H_0: {\beta}_0 = 0\)`

`\(H_0: {\mu}_{\text{F1}} = 0\)`

:::::

::::

:::

---

::::: block

### Sum contrast

- （2水準の場合）一方の水準に-1を，他方の水準に1を充てる
- 効果全体を全体平均に「中心化」する
  - 全体平均 (Grand Mean)：各水準の平均を平均した値
- scaled sum contrasts; effect coding
  - （2水準の場合）一方の水準に-0.5を，他方の水準に0.5を充てる
  - 傾きが，2水準の差と同じ値になる

:::::

---

count: false
 
### Scaled sum contrastsとその意味
.panel1-sum-simdat-auto[

```r
*contrasts(simdat$F) &lt;- c(-0.5, 0.5)

contrasts(simdat$F)
```
]
 
.panel2-sum-simdat-auto[

```
   [,1]
F1 -0.5
F2  0.5
```
]
 
.panel3-sum-simdat-auto[
`$$x = \begin{cases} -0.5 &amp; \text{F1 のとき} \\ 0.5 &amp; \text{F2 のとき} \end{cases}$$`
]

&lt;style&gt;
.panel1-sum-simdat-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-sum-simdat-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-sum-simdat-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::: columns

:::: pull-left

::::: block

### Sum contrast

- （2水準の場合）一方の水準に-1を，他方の水準に1を充てる
- 効果全体を全体平均に「中心化」する
  - 全体平均 (Grand Mean)：各水準の平均を平均した値
- scaled sum contrasts; effect coding
  - （2水準の場合）一方の水準に-0.5を，他方の水準に0.5を充てる
  - 傾きが，2水準の差と同じ値になる

:::::

::::

:::: pull-right


```r
m1_mr &lt;- lm(DV ~ F, simdat)
```


|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      0.6|[0.454, 0.746]   |       9.5|      0.00|
|F1          |     -0.4|[-0.692, -0.108] |      -3.2|      0.01|

::::

:::

---

::: columns

:::: pull-left

::::: block

### (Scaled) Sum contrasts

`$$x =
\begin{cases}
-0.5 &amp; \text{F1 のとき} \\
0.5 &amp; \text{F2 のとき}
\end{cases}$$`

`$$\therefore \begin{align}\overbrace{y}^{\text{応答変数}} &amp; = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x\\
&amp; =
\begin{cases}
{\beta}_0 + {\beta}_1 \times (-0.5) &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 \times 0.5 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
{\beta}_0 - 0.5{\beta}_1 &amp; \text{F1 のとき}\\
{\beta}_0 + 0.5{\beta}_1 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.6 - 0.5 \times (-0.4) &amp; \text{F1 のとき}\\
0.6 + 0.5 \times (-0.4) &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
0.8 &amp; \text{F1 のとき}\\
0.4 &amp; \text{F2 のとき}
\end{cases}\end{align}$$`

:::::

::::

:::: pull-right

&lt;!--

`$$\begin{align}\overbrace{y}^{\text{応答変数}} &amp; = \overbrace{{\beta}_0}^{\text{切片}} + \overbrace{{\beta}_1}^{\text{傾き}} x\\
&amp; =
\begin{cases}
{\beta}_0 + {\beta}_1 \times 0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 \times 1 &amp; \text{F2 のとき}
\end{cases}\\
&amp; =
\begin{cases}
{\beta}_0 &amp; \text{F1 のとき}\\
{\beta}_0 + {\beta}_1 &amp; \text{F2 のとき}
\end{cases}\end{align}$$`

--&gt;


|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      0.6|[0.454, 0.746]   |       9.5|      0.00|
|F1          |     -0.4|[-0.692, -0.108] |      -3.2|      0.01|

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

::::: block

### (Scaled) Sum contrasts

(Scaled) Sum contrastsの下では，

- 傾き `\({\beta}_1\)`
  - 「一方の条件の応答変数の平均値」と「他方の条件での応答変数の平均値」の差
  - ( `\({\mu}_{\text{F2}} - {\mu}_{\text{F1}}\)` )
- 切片 `\({\beta}_0\)`
  - 「一方の条件の応答変数の平均値」と「他方の条件での応答変数の平均値」の平均値
  - ( `\(\frac{{\mu}_{\text{F1}} + {\mu}_{\text{F2}}}{2}\)` )

:::::

---

::: columns

:::: pull-left

### (Scaled) Sum contrastsの帰無仮説

::::: block

#### 傾き `\({\beta}_1\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：傾きが存在しない

--

`\(H_0: {\beta}_1 = 0\)`

--

`\(H_0: {\mu}_{\text{F2}} - {\mu}_{\text{F1}} = 0\)`

:::::


::::: block

#### 切片 `\({\beta}_0\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：切片が存在しない

--

`\(H_0: {\beta}_0 = 0\)`

--

`\(H_0: \frac{{\mu}_{\text{F1}} + {\mu}_{\text{F2}}}{2} = 0\)`

:::::

::::

:::: pull-right

::::: block

### （参考）F1を統制条件とするTreatment contrastの場合

#### 傾き `\({\beta}_1\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：傾きが存在しない

`\(H_0: {\beta}_1 = 0\)`

`\(H_0: {\mu}_{\text{F2}} - {\mu}_{\text{F1}} = 0\)`

:::::


::::: block

#### 切片 `\({\beta}_0\)` に関する帰無仮説 `\(H_0\)`

帰無仮説：切片が存在しない

`\(H_0: {\beta}_0 = 0\)`

`\(H_0: {\mu}_{\text{F1}} = 0\)`

:::::

::::

:::

---

count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
*simdat
```
]
 
.panel2-grand-mean-auto[

```
    F id   DV Fb
1  F1  1 0.74 F1
2  F1  2 0.55 F1
3  F1  3 0.96 F1
4  F1  4 1.04 F1
5  F1  5 0.70 F1
6  F2  6 0.26 F2
7  F2  7 0.39 F2
8  F2  8 0.17 F2
9  F2  9 0.48 F2
10 F2 10 0.69 F2
```
]
 
.panel3-grand-mean-auto[
データセット
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
* mutate(
*   gross.mean = mean(DV)
* )
```
]
 
.panel2-grand-mean-auto[

```
    F id   DV Fb gross.mean
1  F1  1 0.74 F1        0.6
2  F1  2 0.55 F1        0.6
3  F1  3 0.96 F1        0.6
4  F1  4 1.04 F1        0.6
5  F1  5 0.70 F1        0.6
6  F2  6 0.26 F2        0.6
7  F2  7 0.39 F2        0.6
8  F2  8 0.17 F2        0.6
9  F2  9 0.48 F2        0.6
10 F2 10 0.69 F2        0.6
```
]
 
.panel3-grand-mean-auto[
応答変数全ての平均を計算
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
* group_by(F)
```
]
 
.panel2-grand-mean-auto[

```
# A tibble: 10 x 5
# Groups:   F [2]
   F     id       DV Fb    gross.mean
   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;
 1 F1    1     0.737 F1           0.6
 2 F1    2     0.554 F1           0.6
 3 F1    3     0.963 F1           0.6
 4 F1    4     1.04  F1           0.6
 5 F1    5     0.701 F1           0.6
 6 F2    6     0.262 F2           0.6
 7 F2    7     0.395 F2           0.6
 8 F2    8     0.173 F2           0.6
 9 F2    9     0.483 F2           0.6
10 F2    10    0.687 F2           0.6
```
]
 
.panel3-grand-mean-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
* mutate(
*   lev.wise.mean = mean(DV)
* )
```
]
 
.panel2-grand-mean-auto[

```
# A tibble: 10 x 6
# Groups:   F [2]
   F     id       DV Fb    gross.mean lev.wise.mean
   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
 1 F1    1     0.737 F1           0.6           0.8
 2 F1    2     0.554 F1           0.6           0.8
 3 F1    3     0.963 F1           0.6           0.8
 4 F1    4     1.04  F1           0.6           0.8
 5 F1    5     0.701 F1           0.6           0.8
 6 F2    6     0.262 F2           0.6           0.4
 7 F2    7     0.395 F2           0.6           0.4
 8 F2    8     0.173 F2           0.6           0.4
 9 F2    9     0.483 F2           0.6           0.4
10 F2    10    0.687 F2           0.6           0.4
```
]
 
.panel3-grand-mean-auto[
水準毎に応答変数の平均値を計算
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
* ungroup()
```
]
 
.panel2-grand-mean-auto[

```
# A tibble: 10 x 6
   F     id       DV Fb    gross.mean lev.wise.mean
   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
 1 F1    1     0.737 F1           0.6           0.8
 2 F1    2     0.554 F1           0.6           0.8
 3 F1    3     0.963 F1           0.6           0.8
 4 F1    4     1.04  F1           0.6           0.8
 5 F1    5     0.701 F1           0.6           0.8
 6 F2    6     0.262 F2           0.6           0.4
 7 F2    7     0.395 F2           0.6           0.4
 8 F2    8     0.173 F2           0.6           0.4
 9 F2    9     0.483 F2           0.6           0.4
10 F2    10    0.687 F2           0.6           0.4
```
]
 
.panel3-grand-mean-auto[
まとめ上げを解除
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
* distinct(
*   F, gross.mean, lev.wise.mean
* )
```
]
 
.panel2-grand-mean-auto[

```
# A tibble: 2 x 3
  F     gross.mean lev.wise.mean
  &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1           0.6           0.8
2 F2           0.6           0.4
```
]
 
.panel3-grand-mean-auto[
応答変数全ての平均と水準毎の平均を抽出
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
* summarise(
*   gross.mean = gross.mean,
*   mean.of.lev.wise.mean = mean(lev.wise.mean)
* )
```
]
 
.panel2-grand-mean-auto[

```
# A tibble: 2 x 2
  gross.mean mean.of.lev.wise.mean
       &lt;dbl&gt;                 &lt;dbl&gt;
1        0.6                   0.6
2        0.6                   0.6
```
]
 
.panel3-grand-mean-auto[
水準毎の平均の平均を計算
]

---
count: false
 
### (Un)balanced dataでのGrand Meanの意味
.panel1-grand-mean-auto[

```r
simdat |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
  summarise(
    gross.mean = gross.mean,
    mean.of.lev.wise.mean = mean(lev.wise.mean)
  ) |&gt;
* distinct(
*   gross.mean, mean.of.lev.wise.mean
* )
```
]
 
.panel2-grand-mean-auto[

```
# A tibble: 1 x 2
  gross.mean mean.of.lev.wise.mean
       &lt;dbl&gt;                 &lt;dbl&gt;
1        0.6                   0.6
```
]
 
.panel3-grand-mean-auto[
**Grand Mean**：「各水準で得られた応答変数の平均値」の平均値
]

&lt;style&gt;
.panel1-grand-mean-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-grand-mean-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-grand-mean-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
*set.seed(1)
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

]
 
.panel3-grand-mean-unbalanced-data-auto[
乱数固定
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

*simdat
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
    F id   DV Fb
1  F1  1 0.74 F1
2  F1  2 0.55 F1
3  F1  3 0.96 F1
4  F1  4 1.04 F1
5  F1  5 0.70 F1
6  F2  6 0.26 F2
7  F2  7 0.39 F2
8  F2  8 0.17 F2
9  F2  9 0.48 F2
10 F2 10 0.69 F2
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
データセット
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
* group_split(F)
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
&lt;list_of&lt;
  tbl_df&lt;
    F : factor&lt;1ffb8&gt;
    id: factor&lt;49edf&gt;
    DV: double
    Fb: factor&lt;e285c&gt;
  &gt;
&gt;[2]&gt;
[[1]]
# A tibble: 5 x 4
  F     id       DV Fb   
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
1 F1    1     0.737 F1   
2 F1    2     0.554 F1   
3 F1    3     0.963 F1   
4 F1    4     1.04  F1   
5 F1    5     0.701 F1   

[[2]]
# A tibble: 5 x 4
  F     id       DV Fb   
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
1 F2    6     0.262 F2   
2 F2    7     0.395 F2   
3 F2    8     0.173 F2   
4 F2    9     0.483 F2   
5 F2    10    0.687 F2   
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
データを水準ごとに分割
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
* map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
*   .y = c(2, 1),
*   ~ slice_sample(.x, n = .y)
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 3 x 4
  F     id       DV Fb   
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
1 F1    1     0.737 F1   
2 F1    4     1.04  F1   
3 F2    6     0.262 F2   
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
水準毎のデータから，指定した分だけ無作為抽出（**F1とF2でデータ数が異なるように抽出**）
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
* mutate(
*   gross.mean = mean(DV)
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 3 x 5
  F     id       DV Fb    gross.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;
1 F1    1     0.737 F1         0.681
2 F1    4     1.04  F1         0.681
3 F2    6     0.262 F2         0.681
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
無作為抽出後のデータについて，応答変数全ての平均を計算
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
* group_by(F)
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 3 x 5
# Groups:   F [2]
  F     id       DV Fb    gross.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;
1 F1    1     0.737 F1         0.681
2 F1    4     1.04  F1         0.681
3 F2    6     0.262 F2         0.681
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
* mutate(
*   lev.wise.mean = mean(DV)
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 3 x 6
# Groups:   F [2]
  F     id       DV Fb    gross.mean lev.wise.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1    1     0.737 F1         0.681         0.890
2 F1    4     1.04  F1         0.681         0.890
3 F2    6     0.262 F2         0.681         0.262
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
水準毎に応答変数の平均値を計算
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
* ungroup()
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 3 x 6
  F     id       DV Fb    gross.mean lev.wise.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1    1     0.737 F1         0.681         0.890
2 F1    4     1.04  F1         0.681         0.890
3 F2    6     0.262 F2         0.681         0.262
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
まとめ上げを解除
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
* distinct(
*   F, gross.mean, lev.wise.mean
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 2 x 3
  F     gross.mean lev.wise.mean
  &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1         0.681         0.890
2 F2         0.681         0.262
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
応答変数全ての平均と水準毎の平均を抽出
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
* summarise(
*   gross.mean = gross.mean,
*   mean.of.lev.wise.mean = mean(lev.wise.mean)
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 2 x 2
  gross.mean mean.of.lev.wise.mean
       &lt;dbl&gt;                 &lt;dbl&gt;
1      0.681                 0.576
2      0.681                 0.576
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
水準毎の平均の平均を計算
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
  summarise(
    gross.mean = gross.mean,
    mean.of.lev.wise.mean = mean(lev.wise.mean)
  ) |&gt;
* distinct(
*   gross.mean, mean.of.lev.wise.mean
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

```
# A tibble: 1 x 2
  gross.mean mean.of.lev.wise.mean
       &lt;dbl&gt;                 &lt;dbl&gt;
1      0.681                 0.576
```
]
 
.panel3-grand-mean-unbalanced-data-auto[
「各水準で得られた応答変数の平均値」の平均値と，全データの平均が**一致しない**
]

---
count: false
 
### Unbalanced dataでのGrand Meanの意味
.panel1-grand-mean-unbalanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1から2つ，F2から1つデータを取り出す ####
    .y = c(2, 1),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
  summarise(
    gross.mean = gross.mean,
    mean.of.lev.wise.mean = mean(lev.wise.mean)
  ) |&gt;
  distinct(
    gross.mean, mean.of.lev.wise.mean
  ) |&gt;
* kable(
*   digit = 2,
*   col.names = c(
*     '応答変数全ての平均',
*     '「各水準の平均」の平均'
*   )
* )
```
]
 
.panel2-grand-mean-unbalanced-data-auto[

| 応答変数全ての平均| 「各水準の平均」の平均|
|------------------:|----------------------:|
|               0.68|                   0.58|
]
 
.panel3-grand-mean-unbalanced-data-auto[
「各水準で得られた応答変数の平均値」の平均値と，全データの平均が**一致しない**
]

&lt;style&gt;
.panel1-grand-mean-unbalanced-data-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-grand-mean-unbalanced-data-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-grand-mean-unbalanced-data-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
*set.seed(1)
```
]
 
.panel2-grand-mean-balanced-data-auto[

]
 
.panel3-grand-mean-balanced-data-auto[
乱数固定
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

*simdat
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
    F id   DV Fb
1  F1  1 0.74 F1
2  F1  2 0.55 F1
3  F1  3 0.96 F1
4  F1  4 1.04 F1
5  F1  5 0.70 F1
6  F2  6 0.26 F2
7  F2  7 0.39 F2
8  F2  8 0.17 F2
9  F2  9 0.48 F2
10 F2 10 0.69 F2
```
]
 
.panel3-grand-mean-balanced-data-auto[
データセット
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
* group_split(F)
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
&lt;list_of&lt;
  tbl_df&lt;
    F : factor&lt;1ffb8&gt;
    id: factor&lt;49edf&gt;
    DV: double
    Fb: factor&lt;e285c&gt;
  &gt;
&gt;[2]&gt;
[[1]]
# A tibble: 5 x 4
  F     id       DV Fb   
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
1 F1    1     0.737 F1   
2 F1    2     0.554 F1   
3 F1    3     0.963 F1   
4 F1    4     1.04  F1   
5 F1    5     0.701 F1   

[[2]]
# A tibble: 5 x 4
  F     id       DV Fb   
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
1 F2    6     0.262 F2   
2 F2    7     0.395 F2   
3 F2    8     0.173 F2   
4 F2    9     0.483 F2   
5 F2    10    0.687 F2   
```
]
 
.panel3-grand-mean-balanced-data-auto[
データを水準ごとに分割
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
* map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
*   .y = c(2, 2),
*   ~ slice_sample(.x, n = .y)
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 4 x 4
  F     id       DV Fb   
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;
1 F1    1     0.737 F1   
2 F1    4     1.04  F1   
3 F2    6     0.262 F2   
4 F2    7     0.395 F2   
```
]
 
.panel3-grand-mean-balanced-data-auto[
水準毎のデータから，指定した分だけ無作為抽出（**F1とF2でデータ数が一致するように抽出**）
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
* mutate(
*   gross.mean = mean(DV)
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 4 x 5
  F     id       DV Fb    gross.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;
1 F1    1     0.737 F1         0.609
2 F1    4     1.04  F1         0.609
3 F2    6     0.262 F2         0.609
4 F2    7     0.395 F2         0.609
```
]
 
.panel3-grand-mean-balanced-data-auto[
無作為抽出後のデータについて，応答変数全ての平均を計算
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
* group_by(F)
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 4 x 5
# Groups:   F [2]
  F     id       DV Fb    gross.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;
1 F1    1     0.737 F1         0.609
2 F1    4     1.04  F1         0.609
3 F2    6     0.262 F2         0.609
4 F2    7     0.395 F2         0.609
```
]
 
.panel3-grand-mean-balanced-data-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
* mutate(
*   lev.wise.mean = mean(DV)
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 4 x 6
# Groups:   F [2]
  F     id       DV Fb    gross.mean lev.wise.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1    1     0.737 F1         0.609         0.890
2 F1    4     1.04  F1         0.609         0.890
3 F2    6     0.262 F2         0.609         0.328
4 F2    7     0.395 F2         0.609         0.328
```
]
 
.panel3-grand-mean-balanced-data-auto[
水準毎に応答変数の平均値を計算
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
* ungroup()
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 4 x 6
  F     id       DV Fb    gross.mean lev.wise.mean
  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1    1     0.737 F1         0.609         0.890
2 F1    4     1.04  F1         0.609         0.890
3 F2    6     0.262 F2         0.609         0.328
4 F2    7     0.395 F2         0.609         0.328
```
]
 
.panel3-grand-mean-balanced-data-auto[
まとめ上げを解除
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
* distinct(
*   F, gross.mean, lev.wise.mean
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 2 x 3
  F     gross.mean lev.wise.mean
  &lt;fct&gt;      &lt;dbl&gt;         &lt;dbl&gt;
1 F1         0.609         0.890
2 F2         0.609         0.328
```
]
 
.panel3-grand-mean-balanced-data-auto[
応答変数全ての平均と水準毎の平均を抽出
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
* summarise(
*   gross.mean = gross.mean,
*   mean.of.lev.wise.mean = mean(lev.wise.mean)
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 2 x 2
  gross.mean mean.of.lev.wise.mean
       &lt;dbl&gt;                 &lt;dbl&gt;
1      0.609                 0.609
2      0.609                 0.609
```
]
 
.panel3-grand-mean-balanced-data-auto[
水準毎の平均の平均を計算
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
  summarise(
    gross.mean = gross.mean,
    mean.of.lev.wise.mean = mean(lev.wise.mean)
  ) |&gt;
* distinct(
*   gross.mean, mean.of.lev.wise.mean
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

```
# A tibble: 1 x 2
  gross.mean mean.of.lev.wise.mean
       &lt;dbl&gt;                 &lt;dbl&gt;
1      0.609                 0.609
```
]
 
.panel3-grand-mean-balanced-data-auto[
「各水準で得られた応答変数の平均値」の平均値と，全データの平均が一致する
]

---
count: false
 
### Balanced dataでのGrand Meanの意味
.panel1-grand-mean-balanced-data-auto[

```r
set.seed(1)

simdat |&gt;
  group_split(F) |&gt;
  map2_dfr(
#### F1・F2ともに，2つずつデータを取り出す ####
    .y = c(2, 2),
    ~ slice_sample(.x, n = .y)
  ) |&gt;
  mutate(
    gross.mean = mean(DV)
  ) |&gt;
  group_by(F) |&gt;
  mutate(
    lev.wise.mean = mean(DV)
  ) |&gt;
  ungroup() |&gt;
  distinct(
    F, gross.mean, lev.wise.mean
  ) |&gt;
  summarise(
    gross.mean = gross.mean,
    mean.of.lev.wise.mean = mean(lev.wise.mean)
  ) |&gt;
  distinct(
    gross.mean, mean.of.lev.wise.mean
  ) |&gt;
* kable(
*   digit = 2,
*   col.names = c(
*     '応答変数全ての平均',
*     '「各水準の平均」の平均'
*   )
* )
```
]
 
.panel2-grand-mean-balanced-data-auto[

| 応答変数全ての平均| 「各水準の平均」の平均|
|------------------:|----------------------:|
|               0.61|                   0.61|
]
 
.panel3-grand-mean-balanced-data-auto[
「各水準で得られた応答変数の平均値」の平均値と，全データの平均が一致する
]

&lt;style&gt;
.panel1-grand-mean-balanced-data-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-grand-mean-balanced-data-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-grand-mean-balanced-data-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

::: columns

:::: pull-left

::::: block

#### Balanced dataでのGrand Mean

各水準のデータ数が等しいデータセット
（一切欠損値がないデータセット）
では，

Grand Meanは，応答変数全体の平均に一致


| 応答変数全ての平均| 「各水準の平均」の平均|
|------------------:|----------------------:|
|               0.61|                   0.61|

:::::

::::

:::: pull-right

::::: block

#### Unbalanced dataでのGrand Mean

Grand Meanは，**応答変数全体の平均に一致しない**


| 応答変数全ての平均| 「各水準の平均」の平均|
|------------------:|----------------------:|
|               0.68|                   0.58|

:::::

::::

:::

---

::: columns

:::: pull-left

::::: block

### (\*)Cell means parameterization

- 傾き（水準間の差）や切片を推定しない
- 各水準の下で得られる応答変数の平均が0か否かを検定する
  - （2水準の場合）帰無仮説は2つ
      1. `\(H_0: {\mu}_1 = 0\)`
      1. `\(H_0: {\mu}_2 = 0\)`

:::::

::::

:::: pull-right


```r
m2_mr &lt;- lm(DV ~ -1 + F, simdat)
```


|Predictor | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:---------|--------:|:--------------|---------:|---------:|
|FF1       |      0.8|[0.594, 1.006] |       8.9|         0|
|FF2       |      0.4|[0.194, 0.606] |       4.5|         0|

::::

:::

---

---


class: inverse, middle, center

# Examples of different default contrast types (pp.8--9)

---

class: inverse, middle
&lt;!-- class: inverse, middle, split-50 --&gt;

## さまざまな対比行列

1. Contrast matrices
2. Treatment contrast
3. Sum contrast
4. Repeated contrast
5. Polynomial contrast
6. Helmert contrast
7. 任意の対比行列を充てる方法

---

::::: block

## Contrast matrices

- 対比を表す係数値（傾き・切片）は，係数値の行列で表現される
- 係数値の行列は，対比行列で実装される

:::::

---


class: split-50

name: treatment-contrast

## Treatment contrast 処理対比の対比行列

::: columns

:::: pull-left

&lt;!--
- 実験的介入treatmentの効果を，非介入群との比較で検討
  - 実験群 vs 統制群
- 各実験群を同一の統制群と比べる
--&gt;

- 例：様々なプライミング効果を，同一の統制群と比べる
    3. プライミングなし（統制群）
    1. 音韻的プライミング（実験群1）
    2. 綴字プライミング（実験群2）

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-36-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::: pull-right


```r
#contr.treatment(3)
contr.treatment(demoDataTreatment$priming)
```


```
             orthographic phonological
control                 0            0
orthographic            1            0
phonological            0            1
```

--

- 各行：**水準** 上から
    3. **統制群**：プライミングなし
    2. **実験群1**：綴字プライミング
    1. **実験群2**：音韻的プライミング

--

- 各列：**対比する水準の組合せ** 左から
    1. **実験群1 vs 統制群**  
      （綴字プライミング vs プライミングなし）
    2. **実験群2 vs 統制群**  
      （音韻的プライミング vs プライミングなし）


::::

:::

---


class: split-50

name: treatment-contrast

## Sum contrast 零和対比の対比行列

::: columns

:::: pull-left

- 例：様々なプライミング効果を，全体平均と比べる
    1. 音韻的プライミング（実験群1）
    2. 綴字プライミング（実験群2）
    3. 意味プライミング

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-39-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::: pull-right


```r
#contr.sum(3)
contr.sum(demoDataSum$priming)
```


```
             [,1] [,2]
orthographic    1    0
phonological    0    1
semantic       -1   -1
```

--

- 各行：**水準** 上から
    1. 音韻的プライミング
    2. 綴字プライミング
    3. 意味プライミング

--

- 各列：**対比する水準の組合せ** 左から
    1. **実験群1 vs 全体平均**  
      （音韻的プライミング vs 全体平均）
    2. **実験群2 vs 全体平均**  
      （綴字プライミング vs 全体平均）


::::

:::

---


class: split-50

name: repeated-contrast

## Repeated contrastの対比行列

::: columns

:::: pull-left

- 例：語の頻度の効果を，隣り合う水準と比べる
    1. 低頻度
    2. 中頻度
    3. 高頻度

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-42-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::: pull-right


```r
#contr.sdif(3)
contr.sdif(demoDataFreq$frequency)
```


```
       medium-low high-medium
low         -0.67       -0.33
medium       0.33       -0.33
high         0.33        0.67
```

--

- 各行：**水準** 上から
    1. 低頻度
    2. 中頻度
    3. 高頻度

--

- 各列：**対比する水準の組合せ** 左から
    1. **第2水準 vs 第1水準**  
      （中頻度 vs 低頻度）
    2. **第3水準 vs 第2水準**  
      （高頻度 vs 中頻度）


::::

:::

---


class: split-50

name: polynomial-contrast

##  Polynomial contrast 多項式対比の対比行列

::: columns

:::: pull-left

- 例：語の頻度の効果を，隣り合う水準と比べる
    1. 低頻度
    2. 中頻度
    3. 高頻度

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-45-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::: pull-right


```r
#contr.poly(3)
contr.poly(demoDataFreq$frequency)
```


```
                        .L    .Q
[1,] -0.707106781186547573  0.41
[2,] -0.000000000000000079 -0.82
[3,]  0.707106781186547462  0.41
```

--

- 各行：**水準** 上から
    1. 低頻度
    2. 中頻度
    3. 高頻度

--

- 各列：**対比の組合せ** 左から
    1. **1次関数ペース**（Linear; どの水準間でも一定ペースで増加・減少？）
    2. **2次関数ペース**（Quadratic; 次の水準間ほどに増加・減少が激しい・穏やか？）

::::

:::

---


class: split-50

name: helmert-contrast

## Helmert contrast ヘルマート対比の対比行列

::: columns

:::: pull-left

- 例：様々なプライミング効果を，種類ごとに比べる
    1. 無効なプライミング1
    2. 無効なプライミング2
    3. 有効なプライミング

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-48-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::: pull-right


```r
#contr.helmert(3)
contr.helmert(demoDataHelmert$priming)
```


```
         [,1] [,2]
invalid1   -1   -1
invalid2    1   -1
valid       0    2
```

--

- 各行：**水準** 上から
    1. 無効なプライミング1
    2. 無効なプライミング2
    3. 有効なプライミング

--

- 各列：**対比する水準の組合せ** 左から
    1. **小グループ1 vs 小グループ2**  
      （無効なプライミング1 vs 無効なプライミング2）
    2. **小グループ連合 vs 別グループ**  
      （無効なプライミング vs 有効なプライミング）


::::

:::

---

name: simdat2

## 任意の対比行列を充てる方法

::: columns

:::: pull-left

まずは，シミュレーション用データ`simdat2`を作成

- **応答変数**：語彙判断課題の反応時間
- **説明変数**：判断する単語の頻度
  - 頻度が低いほど，反応時間が長い
- 被験者間計画での水準数
  - 3水準
- 被験者内計画での水準数
  - なし
- 被験者間計画での1水準あたりの実験参加者数
  - 4人
  - 計 `\(4 \times 3 = 12\)` 人
- 各水準での応答変数の平均値
  - 500, 450, 400
- 要因の標準偏差
  - 20

::::

:::: pull-right


```r
set.seed(1212); simdat2 &lt;- mixedDesign(
  B = 3,
  W = NULL,
  n = 4,
  M = matrix(
    c(500, 450, 400),
    nrow = 3,
    ncol = 1,
    byrow = FALSE
  ),
  SD = 20,
  long = TRUE
) |&gt;
  rename(F = B_A) |&gt;
  mutate(
    F = fct_recode(
      F,
      low    = "A1",
      medium = "A2",
      high   = "A3"
    )
  )
```



::::

:::

---

count: false
 
## 任意の対比行列を充てる方法
.panel1-multiple-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- contr.treatment(3)

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  summary()
```
]
 
.panel2-multiple-contrasts-rotate[

```
       2 3
low    0 0
medium 1 0
high   0 1
```

```

Call:
lm(formula = DV ~ F, data = simdat2)

Residuals:
    Min      1Q  Median      3Q     Max 
-25.875 -13.011   0.419  14.211  24.685 

Coefficients:
            Estimate Std. Error t value        Pr(&gt;|t|)    
(Intercept)    500.0       10.0   50.00 0.0000000000026 ***
F2             -50.0       14.1   -3.54          0.0064 ** 
F3            -100.0       14.1   -7.07 0.0000584918826 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 20 on 9 degrees of freedom
Multiple R-squared:  0.847,	Adjusted R-squared:  0.814 
F-statistic:   25 on 2 and 9 DF,  p-value: 0.000211
```
]
 
.panel3-multiple-contrasts-rotate[
Treatment contrastsを適用
]

---
count: false
 
## 任意の対比行列を充てる方法
.panel1-multiple-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- contr.sum(3)

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  summary()
```
]
 
.panel2-multiple-contrasts-rotate[

```
       [,1] [,2]
low       1    0
medium    0    1
high     -1   -1
```

```

Call:
lm(formula = DV ~ F, data = simdat2)

Residuals:
    Min      1Q  Median      3Q     Max 
-25.875 -13.011   0.419  14.211  24.685 

Coefficients:
                        Estimate           Std. Error t value          Pr(&gt;|t|)
(Intercept) 450.0000000000001705   5.7735026918962697   77.94 0.000000000000048
F1           50.0000000000001066   8.1649658092772768    6.12           0.00017
F2           -0.0000000000000508   8.1649658092772750    0.00           1.00000
               
(Intercept) ***
F1          ***
F2             
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 20 on 9 degrees of freedom
Multiple R-squared:  0.847,	Adjusted R-squared:  0.814 
F-statistic:   25 on 2 and 9 DF,  p-value: 0.000211
```
]
 
.panel3-multiple-contrasts-rotate[
Sum contrastsを適用
]

---
count: false
 
## 任意の対比行列を充てる方法
.panel1-multiple-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- contr.sdif(3)

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  summary()
```
]
 
.panel2-multiple-contrasts-rotate[

```
         2-1   3-2
low    -0.67 -0.33
medium  0.33 -0.33
high    0.33  0.67
```

```

Call:
lm(formula = DV ~ F, data = simdat2)

Residuals:
    Min      1Q  Median      3Q     Max 
-25.875 -13.011   0.419  14.211  24.685 

Coefficients:
            Estimate Std. Error t value          Pr(&gt;|t|)    
(Intercept)   450.00       5.77   77.94 0.000000000000048 ***
F2-1          -50.00      14.14   -3.54            0.0064 ** 
F3-2          -50.00      14.14   -3.54            0.0064 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 20 on 9 degrees of freedom
Multiple R-squared:  0.847,	Adjusted R-squared:  0.814 
F-statistic:   25 on 2 and 9 DF,  p-value: 0.000211
```
]
 
.panel3-multiple-contrasts-rotate[
Repeated contrastsを適用
]

---
count: false
 
## 任意の対比行列を充てる方法
.panel1-multiple-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- contr.poly(3)

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  summary()
```
]
 
.panel2-multiple-contrasts-rotate[

```
                          .L    .Q
low    -0.707106781186547573  0.41
medium -0.000000000000000079 -0.82
high    0.707106781186547462  0.41
```

```

Call:
lm(formula = DV ~ F, data = simdat2)

Residuals:
    Min      1Q  Median      3Q     Max 
-25.875 -13.011   0.419  14.211  24.685 

Coefficients:
                        Estimate           Std. Error t value          Pr(&gt;|t|)
(Intercept) 450.0000000000001705   5.7735026918962697   77.94 0.000000000000048
F.L         -70.7106781186548830  10.0000000000000231   -7.07 0.000058491882571
F.Q           0.0000000000000631  10.0000000000000178    0.00                 1
               
(Intercept) ***
F.L         ***
F.Q            
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 20 on 9 degrees of freedom
Multiple R-squared:  0.847,	Adjusted R-squared:  0.814 
F-statistic:   25 on 2 and 9 DF,  p-value: 0.000211
```
]
 
.panel3-multiple-contrasts-rotate[
Polynomial contrastsを適用
]

---
count: false
 
## 任意の対比行列を充てる方法
.panel1-multiple-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- contr.helmert(3)

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  summary()
```
]
 
.panel2-multiple-contrasts-rotate[

```
       [,1] [,2]
low      -1   -1
medium    1   -1
high      0    2
```

```

Call:
lm(formula = DV ~ F, data = simdat2)

Residuals:
    Min      1Q  Median      3Q     Max 
-25.875 -13.011   0.419  14.211  24.685 

Coefficients:
            Estimate Std. Error t value          Pr(&gt;|t|)    
(Intercept)   450.00       5.77   77.94 0.000000000000048 ***
F1            -25.00       7.07   -3.54           0.00636 ** 
F2            -25.00       4.08   -6.12           0.00017 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 20 on 9 degrees of freedom
Multiple R-squared:  0.847,	Adjusted R-squared:  0.814 
F-statistic:   25 on 2 and 9 DF,  p-value: 0.000211
```
]
 
.panel3-multiple-contrasts-rotate[
Helmert contrastsを適用
]

&lt;style&gt;
.panel1-multiple-contrasts-rotate {
  color: black;
  width: 48.5%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-multiple-contrasts-rotate {
  color: black;
  width: 32.3333333333333%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-multiple-contrasts-rotate {
  color: black;
  width: 16.1666666666667%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---


class: inverse, middle, center

# The hypothesis matrix illustrated with a three-level factor (pp.9--12)

---

class: inverse, middle
&lt;!-- class: inverse, middle, split-50 --&gt;

## さまざまな対比行列

1. シミュレーション用データについて
2. Sum contrasts
3. The hypothesis matrix
  1. 検証したい仮説を用意する
  1. 重みづけを抽出し，「仮説行列」 *hypothesis matrix* に書く
  1. 一般化逆行列 *generalised matrix inverse* を使い，仮説行列を対比行列に変換
  1. 対比行列を要因に当てはめ，線形モデルを走らせる


---

## シミュレーション用データについて

::: columns

:::: pull-left

::::: block

- データ：`simdat2`
  - 本資料では，[前のセクション](#simdat2)で作成済
- **応答変数**：語彙判断課題の反応時間
- **説明変数**：判断する単語の頻度
  - 頻度が低いほど，反応時間が長い
- 被験者間計画での水準数
  - 3水準（低頻度・中頻度・高頻度）
- 被験者内計画での水準数
  - なし
- 被験者間計画での1水準あたりの実験参加者数
  - 4人
  - 計 `\(4 \times 3 = 12\)` 人
- 各水準での応答変数の平均値
  - 500, 450, 400
- 要因の標準偏差
  - 20

:::::

::::

:::: pull-right

::::: block

### 検証する仮説

1. 低頻度語への反応時間 `\(\mu_1\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
2. 中頻度語への反応時間 `\(\mu_2\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？

`$$\begin{aligned}
{H_0}_1: \overbrace{\mu_1}^{\text{低頻度語への反応時間}} = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}
\end{aligned}$$`

`$$\begin{aligned}
{H_0}_2: \overbrace{\mu_2}^{\text{中頻度語への反応時間}} = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}
\end{aligned}$$`

:::::

::::

:::

---


name: sum-contrast-weights

## Sum contrast

`\(\mu_1\)`, `\(\mu_2\)`, `\(\mu_3\)` には重みづけがある

::: columns

:::: pull-left

`$$\begin{aligned}
{H_0}_1: \overbrace{\mu_1}^{\text{低頻度語への反応時間}} &amp; = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}\\
\Leftrightarrow \mu_1 &amp; = \frac{1}{3}\mu_1 + \frac{1}{3}\mu_2 + \frac{1}{3}\mu_3 \\
\Leftrightarrow \frac{2}{3}\mu_1 - \frac{1}{3}\mu_2 - \frac{1}{3}\mu_3 &amp; = 0
\end{aligned}$$`

`$$(\underbrace{\frac{2}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{-\frac{1}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{-\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

::::

:::: pull-right

`$$\begin{aligned}
{H_0}_2: \overbrace{\mu_2}^{\text{中頻度語への反応時間}} &amp; = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}\\
\Leftrightarrow \mu_2 &amp; = \frac{1}{3}\mu_1 + \frac{1}{3}\mu_2 + \frac{1}{3}\mu_3 \\
\Leftrightarrow -\frac{1}{3}\mu_1 + \frac{2}{3}\mu_2 - \frac{1}{3}\mu_3 &amp; = 0
\end{aligned}$$`

`$$(\underbrace{-\frac{1}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{\frac{2}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{-\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

::::

:::

---


## Hypotheis matrix

- ある対比を使って本当に仮説を正しく検証できるか確認する
  - 例：
  - 「低頻度語への反応時間 `\(\mu_1\)` が，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？」を調べるのに， `\({H_0}_1: \mu_1 = \frac{\mu_1 + \mu_2 + \mu_3}{3}\)` という対比を使って問題ないか
- 検証したい帰無仮説や使いたい実験デザインによっては，Rの`contr.*()`関数で作れる対比行列を当てはめられないことがある
  - **どのように対比行列が作られるのか理解する意義がある**

---

## 対比行列を自分で作る

1. 検証したい帰無仮説を用意する
1. 重みづけ（例：sum contrastであれば[この重みづけ](#sum-contrast-weights)）を抽出し，「仮説行列」 *hypothesis matrix* に書く
1. 一般化逆行列 *generalised matrix inverse* を使い，仮説行列を対比行列に変換
1. 対比行列を要因に当てはめ，線形モデルを実行

仮説行列?? `\(\to\)` 

|   |   |
|--:|--:|
|  1|  0|
|  0|  1|
| -1| -1|




---

## 検証したい帰無仮説を用意する

::: columns

:::: pull-left

- **応答変数**：語彙判断課題の反応時間
- **説明変数**：判断する単語の頻度
  - 頻度が低いほど，反応時間が長い
- 被験者間計画での水準数
  - 3水準（低頻度・中頻度・高頻度）

::::: block

### 検証する仮説

1. 低頻度語への反応時間 `\(\mu_1\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
2. 中頻度語への反応時間 `\(\mu_2\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
3. 全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` は0秒と同じ？

:::::

::::

:::: pull-right

`$$\begin{aligned}
{H_0}_1: \overbrace{\mu_1}^{\text{低頻度語への反応時間}} = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}
\end{aligned}$$`

`$$\begin{aligned}
{H_0}_2: \overbrace{\mu_2}^{\text{中頻度語への反応時間}} = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}
\end{aligned}$$`

`$$\begin{aligned}
{H_0}_0: \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均} = 0
\end{aligned}$$`

::::

:::

---

## 検証したい帰無仮説を用意する

::::: block

### 研究上の問い

- **応答変数**：語彙判断課題の反応時間
- **説明変数**：判断する単語の頻度
  - 頻度が低いほど，反応時間が長い
- 被験者間計画での水準数
  - 3水準（低頻度・中頻度・高頻度）

:::::

---

## 検証したい帰無仮説を用意する

::: columns

:::: pull-left

::::: block

### 検証する仮説

1. 低頻度語への反応時間 `\(\mu_1\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
2. 中頻度語への反応時間 `\(\mu_2\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
3. 全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` は0秒と同じ？

:::::

::::

:::: pull-right

`$$\begin{aligned}
{H_0}_1: \overbrace{\mu_1}^{\text{低頻度語への反応時間}} = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}
\end{aligned}$$`

`$$\begin{aligned}
{H_0}_2: \overbrace{\mu_2}^{\text{中頻度語への反応時間}} = \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均}
\end{aligned}$$`

`$$\begin{aligned}
{H_0}_0: \overbrace{\frac{\mu_1 + \mu_2 + \mu_3}{3}}^{全体平均} = 0
\end{aligned}$$`

::::

:::

---

## 検証したい帰無仮説を用意する

::: columns

:::: pull-left

::::: block

### 検証する仮説

1. 低頻度語への反応時間 `\(\mu_1\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
2. 中頻度語への反応時間 `\(\mu_2\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - 全体平均より長い？短い？
3. 全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` は0秒と同じ？

:::::

::::

:::: pull-right

`$${H_0}_1: (\underbrace{\frac{2}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{-\frac{1}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{-\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

`$${H_0}_2: (\underbrace{-\frac{1}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{\frac{2}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{-\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

`$${H_0}_0: (\underbrace{\frac{1}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{\frac{1}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

::::

:::

---

## 重みづけを抽出し，「仮説行列」に書く

`\(\mu_1\)`, `\(\mu_2\)`, `\(\mu_3\)` には重みづけがある

::: columns

:::: pull-left

`$${H_0}_1: (\underbrace{\frac{2}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{-\frac{1}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{-\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

`$${H_0}_2: (\underbrace{-\frac{1}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{\frac{2}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{-\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

`$${H_0}_0: (\underbrace{\frac{1}{3}}_{\mu_1\text{への重み}}\mu_1) + (\underbrace{\frac{1}{3}}_{\mu_2\text{への重み}}\mu_2) + (\underbrace{\frac{1}{3}}_{\mu_3\text{への重み}}\mu_3) = 0$$`

::::

:::: pull-right

- 各行：**帰無仮説**
  - `\({H_0}_0\)`: `cH00`
  - `\({H_0}_1\)`: `cH01`
  - `\({H_0}_2\)`: `cH02`
- 各列：各水準への**重み**


```r
HcSum &lt;- rbind(
  cH00 = c(low =  1/3, med =  1/3, hi =  1/3),
  cH01 = c(low =  2/3, med = -1/3, hi = -1/3),
  cH02 = c(low = -1/3, med =  2/3, hi = -1/3)
)
```



&lt;!--

tidyverseの関数で実行することもできるが，
t()でcH**の情報が失われる

bind_rows(
  cH00 = c(low =  1/3, med =  1/3, hi =  1/3),
  cH01 = c(low =  2/3, med = -1/3, hi = -1/3),
  cH02 = c(low = -1/3, med =  2/3, hi = -1/3)
) #|&gt;
  t() |&gt;
  fractions()

--&gt;

::::

:::

---

count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-sum-hypothesis-matrix-transpose-auto[

```r
*HcSum
```
]
 
.panel2-sum-hypothesis-matrix-transpose-auto[

```
       low   med    hi
cH00  0.33  0.33  0.33
cH01  0.67 -0.33 -0.33
cH02 -0.33  0.67 -0.33
```
]
 
.panel3-sum-hypothesis-matrix-transpose-auto[
仮説行列
]

---
count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-sum-hypothesis-matrix-transpose-auto[

```r
HcSum |&gt;
* fractions()
```
]
 
.panel2-sum-hypothesis-matrix-transpose-auto[

```
     low  med  hi  
cH00  1/3  1/3  1/3
cH01  2/3 -1/3 -1/3
cH02 -1/3  2/3 -1/3
```
]
 
.panel3-sum-hypothesis-matrix-transpose-auto[
小数表記を分数表記に改める
]

---
count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-sum-hypothesis-matrix-transpose-auto[

```r
HcSum |&gt;
  fractions()

*HcSum
```
]
 
.panel2-sum-hypothesis-matrix-transpose-auto[

```
     low  med  hi  
cH00  1/3  1/3  1/3
cH01  2/3 -1/3 -1/3
cH02 -1/3  2/3 -1/3
```

```
       low   med    hi
cH00  0.33  0.33  0.33
cH01  0.67 -0.33 -0.33
cH02 -0.33  0.67 -0.33
```
]
 
.panel3-sum-hypothesis-matrix-transpose-auto[
仮説行列
]

---
count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-sum-hypothesis-matrix-transpose-auto[

```r
HcSum |&gt;
  fractions()

HcSum |&gt;
* t()
```
]
 
.panel2-sum-hypothesis-matrix-transpose-auto[

```
     low  med  hi  
cH00  1/3  1/3  1/3
cH01  2/3 -1/3 -1/3
cH02 -1/3  2/3 -1/3
```

```
    cH00  cH01  cH02
low 0.33  0.67 -0.33
med 0.33 -0.33  0.67
hi  0.33 -0.33 -0.33
```
]
 
.panel3-sum-hypothesis-matrix-transpose-auto[
仮説行列を転置 *transpose*  
今度は各行が水準，各列が仮説に変わる
]

---
count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-sum-hypothesis-matrix-transpose-auto[

```r
HcSum |&gt;
  fractions()

HcSum |&gt;
  t() |&gt;
* fractions()
```
]
 
.panel2-sum-hypothesis-matrix-transpose-auto[

```
     low  med  hi  
cH00  1/3  1/3  1/3
cH01  2/3 -1/3 -1/3
cH02 -1/3  2/3 -1/3
```

```
    cH00 cH01 cH02
low  1/3  2/3 -1/3
med  1/3 -1/3  2/3
hi   1/3 -1/3 -1/3
```
]
 
.panel3-sum-hypothesis-matrix-transpose-auto[
小数表記を分数表記に改める
]

&lt;style&gt;
.panel1-sum-hypothesis-matrix-transpose-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-sum-hypothesis-matrix-transpose-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-sum-hypothesis-matrix-transpose-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-auto[

```r
*XcSum &lt;- HcSum

XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-auto[

```
       low   med    hi
cH00  0.33  0.33  0.33
cH01  0.67 -0.33 -0.33
cH02 -0.33  0.67 -0.33
```
]
 
.panel3-sum-hypothesis-matrix-ginv-auto[
仮説行列に対し…
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-auto[

```r
XcSum &lt;- HcSum |&gt;
* hypr::ginv2()

XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```
]
 
.panel3-sum-hypothesis-matrix-ginv-auto[
一般化逆行列を適用，仮説行列を対比行列に変換
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-auto[

```r
XcSum &lt;- HcSum |&gt;
  hypr::ginv2()

*XcSum &lt;- HcSum

XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-auto[

```
       low   med    hi
cH00  0.33  0.33  0.33
cH01  0.67 -0.33 -0.33
cH02 -0.33  0.67 -0.33
```
]
 
.panel3-sum-hypothesis-matrix-ginv-auto[
仮説行列に対し…
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-auto[

```r
XcSum &lt;- HcSum |&gt;
  hypr::ginv2()

XcSum &lt;- HcSum |&gt;
* ginv()

XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-auto[

```
     [,1] [,2]                 [,3]
[1,]    1    1 -0.00000000000000022
[2,]    1    0  0.99999999999999956
[3,]    1   -1 -1.00000000000000044
```
]
 
.panel3-sum-hypothesis-matrix-ginv-auto[
一般化逆行列を適用，仮説行列を対比行列に変換
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-auto[

```r
XcSum &lt;- HcSum |&gt;
  hypr::ginv2()

XcSum &lt;- HcSum |&gt;
  ginv() |&gt;
* provideDimnames(base = dimnames(HcSum)[2:1])

XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-auto[

```
    cH00 cH01                 cH02
low    1    1 -0.00000000000000022
med    1    0  0.99999999999999956
hi     1   -1 -1.00000000000000044
```
]
 
.panel3-sum-hypothesis-matrix-ginv-auto[
行名・列名を再付与
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-auto[

```r
XcSum &lt;- HcSum |&gt;
  hypr::ginv2()

XcSum &lt;- HcSum |&gt;
  ginv() |&gt;
  provideDimnames(base = dimnames(HcSum)[2:1]) |&gt;
* fractions()

XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```
]
 
.panel3-sum-hypothesis-matrix-ginv-auto[
分数表記に
]

&lt;style&gt;
.panel1-sum-hypothesis-matrix-ginv-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-sum-hypothesis-matrix-ginv-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-sum-hypothesis-matrix-ginv-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-contr-sum-auto[

```r
*XcSum
```
]
 
.panel2-sum-hypothesis-matrix-ginv-contr-sum-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```
]
 
.panel3-sum-hypothesis-matrix-ginv-contr-sum-auto[
仮説行列に一般化逆行列を適用したもの
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-contr-sum-auto[

```r
XcSum

*contr.sum(3)
```
]
 
.panel2-sum-hypothesis-matrix-ginv-contr-sum-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```

```
  [,1] [,2]
1    1    0
2    0    1
3   -1   -1
```
]
 
.panel3-sum-hypothesis-matrix-ginv-contr-sum-auto[
3水準の時のsum contrast
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-contr-sum-auto[

```r
XcSum

contr.sum(3)

*1 
```
]
 
.panel2-sum-hypothesis-matrix-ginv-contr-sum-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```

```
  [,1] [,2]
1    1    0
2    0    1
3   -1   -1
```

```
[1] 1
```
]
 
.panel3-sum-hypothesis-matrix-ginv-contr-sum-auto[
1を…
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-contr-sum-auto[

```r
XcSum

contr.sum(3)

1 |&gt;
* cbind(contr.sum(3))
```
]
 
.panel2-sum-hypothesis-matrix-ginv-contr-sum-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```

```
  [,1] [,2]
1    1    0
2    0    1
3   -1   -1
```

```
  [,1] [,2] [,3]
1    1    1    0
2    1    0    1
3    1   -1   -1
```
]
 
.panel3-sum-hypothesis-matrix-ginv-contr-sum-auto[
3水準の時のsum contrastの行列の1列目に付与
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-sum-hypothesis-matrix-ginv-contr-sum-auto[

```r
XcSum

contr.sum(3)

1 |&gt;
  cbind(contr.sum(3)) |&gt;
* fractions()
```
]
 
.panel2-sum-hypothesis-matrix-ginv-contr-sum-auto[

```
    cH00 cH01 cH02
low  1    1    0  
med  1    0    1  
hi   1   -1   -1  
```

```
  [,1] [,2]
1    1    0
2    0    1
3   -1   -1
```

```
  [,1] [,2] [,3]
1  1    1    0  
2  1    0    1  
3  1   -1   -1  
```
]
 
.panel3-sum-hypothesis-matrix-ginv-contr-sum-auto[
分数表記に
]

&lt;style&gt;
.panel1-sum-hypothesis-matrix-ginv-contr-sum-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-sum-hypothesis-matrix-ginv-contr-sum-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-sum-hypothesis-matrix-ginv-contr-sum-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- XcSum[, colnames(XcSum) != "cH00"]

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(2),
      ", ",
      conf.high |&gt; round(2),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```
]
 
.panel2-manual-contrasts-rotate[

```
       cH01 cH02
low     1    0  
medium  0    1  
high   -1   -1  
```



|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      450|[436.94, 463.06] |      77.9|         0|
|FcH01       |       50|[31.53, 68.47]   |       6.1|         0|
|FcH02       |        0|[-18.47, 18.47]  |       0.0|         1|
]
 
.panel3-manual-contrasts-rotate[
仮説行列から作ったSum contrastsを適用
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-contrasts-rotate[

```r
*contrasts(simdat2$F) &lt;- contr.sum(3)

contrasts(simdat2$F)

lm(DV ~ F, data = simdat2) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(2),
      ", ",
      conf.high |&gt; round(2),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```
]
 
.panel2-manual-contrasts-rotate[

```
       [,1] [,2]
low       1    0
medium    0    1
high     -1   -1
```



|Predictor   | Estimate|95% CI           | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------------|---------:|---------:|
|(Intercept) |      450|[436.94, 463.06] |      77.9|         0|
|F1          |       50|[31.53, 68.47]   |       6.1|         0|
|F2          |        0|[-18.47, 18.47]  |       0.0|         1|
]
 
.panel3-manual-contrasts-rotate[
**contr.sum(3)**で作ったSum contrastsを適用
]

&lt;style&gt;
.panel1-manual-contrasts-rotate {
  color: black;
  width: 48.5%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-manual-contrasts-rotate {
  color: black;
  width: 32.3333333333333%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-manual-contrasts-rotate {
  color: black;
  width: 16.1666666666667%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## 統計モデルから仮説を検証

::: columns

:::: pull-left

::::: block

&lt;!--
### 検証する仮説
--&gt;

1. 低頻度語への反応時間 `\(\mu_1\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - `FcH01`より， `\(\mu_1 - \frac{\mu_1 + \mu_2 + \mu_3}{3} = 50\)`
    - `\(t\)` 値が `\(t(9)\)` の両側2.5% `\(t \leq -2.26, 2.26 \leq t\)`にあるため，低頻度語への反応時間は全体平均より有意に長い
2. 中頻度語への反応時間 `\(\mu_2\)` は，全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` と同じか？
    - `FcH02`より， `\(\mu_2 - \frac{\mu_1 + \mu_2 + \mu_3}{3} = 0\)`
    - `\(t\)` 値が `\(t(9)\)` の両側2.5%にないため，低頻度語への反応時間と全体平均の差は有意ではない
3. 全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3}{3}\)` は0秒と同じ？
    - `(Intercept)`より， `\(\frac{\mu_1 + \mu_2 + \mu_3}{3} = 450\)`

:::::

::::

:::: pull-right


|Predictor   | Estimate|95% CI     | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:----------|---------:|---------:|
|(Intercept) |      450|[437, 463] |      77.9|         0|
|FcH01       |       50|[32, 68]   |       6.1|         0|
|FcH02       |        0|[-18, 18]  |       0.0|         1|

&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat2-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---


class: inverse, middle, center

# Further examples of contrasts illustrated with a factor with four levels (pp.12--16)

---

class: inverse, middle
&lt;!-- class: inverse, middle, split-50 --&gt;

## 1要因4水準のデータに，さまざまな対比行列を当てはめる

1. Repeated contrast
2. Contrasts in linear regression analysis: The design or model matrix
3. Polynomial contrasts
4. Custom contrasts

---

## シミュレーション用データについて

::: columns

:::: pull-left

::::: block

- データ：`simdat3`
  - [Heister, Würzner, &amp; Kliegl (2012)](http://read.psych.uni-potsdam.de/pmr2/attachments/article/138/Heister_etal.Chapter.2012.pdf)の実験結果に基づくシミュレーション
- **応答変数**：fixation duration
- **説明変数**：単語の頻度
- 被験者間計画での水準数
  - 4水準
- 被験者内計画での水準数
  - なし
- 被験者間計画での1水準あたりの実験参加者数
  - 5人
  - 計 `\(4 \times 5 = 20\)` 人
- 各水準での応答変数の平均値
  - 10, 20, 10, 40
- 要因の標準偏差
  - 10

:::::

::::

:::: pull-right


```r
set.seed(1212); simdat3 &lt;- mixedDesign(
  B = 4,
  W = NULL,
  n = 5,
  M = matrix(
    c(10, 20, 10, 40),
    nrow = 4,
    ncol = 1,
    byrow = FALSE
  ),
  SD = 10,
  long = TRUE
) |&gt;
  rename(F = B_A) |&gt;
  mutate(
    F = fct_recode(
      F,
      low           = "A1",
      `medium-low`  = "A2",
      `medium-high` = "A3",
      high          = "A4"
    )
  )
```



::::

:::

---

count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat3-auto[

```r
*simdat3
```
]
 
.panel2-fig-simdat3-auto[

```
             F id   DV
1          low  1  3.6
2          low  2 11.3
3          low  3  7.3
4          low  4  1.2
5          low  5 26.5
6   medium-low  6  9.2
7   medium-low  7 36.5
8   medium-low  8 17.9
9   medium-low  9 18.0
10  medium-low 10 18.4
11 medium-high 11 -3.7
12 medium-high 12 13.7
13 medium-high 13 22.6
14 medium-high 14  4.4
15 medium-high 15 13.0
16        high 16 51.2
17        high 17 34.0
18        high 18 35.9
19        high 19 28.9
20        high 20 50.0
```
]
 
.panel3-fig-simdat3-auto[
データセット
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat3-auto[

```r
simdat3 |&gt;
* group_by(F)
```
]
 
.panel2-fig-simdat3-auto[

```
# A tibble: 20 x 3
# Groups:   F [4]
   F           id       DV
   &lt;fct&gt;       &lt;fct&gt; &lt;dbl&gt;
 1 low         1      3.57
 2 low         2     11.3 
 3 low         3      7.34
 4 low         4      1.22
 5 low         5     26.5 
 6 medium-low  6      9.24
 7 medium-low  7     36.5 
 8 medium-low  8     17.9 
 9 medium-low  9     18.0 
10 medium-low  10    18.4 
11 medium-high 11    -3.71
12 medium-high 12    13.7 
13 medium-high 13    22.6 
14 medium-high 14     4.44
15 medium-high 15    13.0 
16 high        16    51.2 
17 high        17    34.0 
18 high        18    35.9 
19 high        19    28.9 
20 high        20    50.0 
```
]
 
.panel3-fig-simdat3-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
* summarise(
*   N = length(DV),
*   M = mean(DV),
*   SD = sd(DV),
*   SE = SD / sqrt(N)
* )
```
]
 
.panel2-fig-simdat3-auto[

```
# A tibble: 4 x 5
  F               N     M    SD    SE
  &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 low             5    10    10  4.47
2 medium-low      5    20    10  4.47
3 medium-high     5    10    10  4.47
4 high            5    40    10  4.47
```
]
 
.panel3-fig-simdat3-auto[
水準毎に，  
- データの個数**N**，  
- 応答変数の平均値**M**，  
- 応答変数の平均値の標準偏差**SD**，  
- 応答変数の平均値の標準偏差**SE**  
  
を計算
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
* ungroup()
```
]
 
.panel2-fig-simdat3-auto[

```
# A tibble: 4 x 5
  F               N     M    SD    SE
  &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 low             5    10    10  4.47
2 medium-low      5    20    10  4.47
3 medium-high     5    10    10  4.47
4 high            5    40    10  4.47
```
]
 
.panel3-fig-simdat3-auto[
まとめ上げを解除
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
* mutate(
*   GM = mean(M)
* )
```
]
 
.panel2-fig-simdat3-auto[

```
# A tibble: 4 x 6
  F               N     M    SD    SE    GM
  &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 low             5    10    10  4.47    20
2 medium-low      5    20    10  4.47    20
3 medium-high     5    10    10  4.47    20
4 high            5    40    10  4.47    20
```
]
 
.panel3-fig-simdat3-auto[
線グラフを描画
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-fig-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
  mutate(
    GM = mean(M)
  ) |&gt;
* (
*   \(d){
*     qplot(
*       x = F, y = M,
*       group = 1,
*       data = d,
*       geom = c("point", "line")
*     ) +
*     geom_errorbar(
*       aes(
*         max = M + SE,
*         min = M - SE
*       ),
*       width = 0
*     ) +
*     labs(
*       y = "Mean DV",
*       x = "Factor F"
*     ) +
*     geom_hline(
*       yintercept = d$GM,
*       linetype = "dashed"
*     )
*   }
* )()
```
]
 
.panel2-fig-simdat3-auto[
&lt;img src="figures/Notes-Schad-etal-2020-fig-simdat3_auto_06_output-1.png" width="576" style="display: block; margin: auto;" /&gt;
]
 
.panel3-fig-simdat3-auto[
誤差範囲 ( `\(\pm 1SE\)` ) を描画  
※ `\(\pm 1SE\)` 自体は95%信頼区間ではない（68%信頼区間）  
※信頼区間にする場合， `\(\pm 1.96SE\)` 
]

&lt;style&gt;
.panel1-fig-simdat3-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-fig-simdat3-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-fig-simdat3-auto {
  color: black;
  width: 19.4%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat3-auto[

```r
*simdat3
```
]
 
.panel2-tab-simdat3-auto[

```
             F id   DV
1          low  1  3.6
2          low  2 11.3
3          low  3  7.3
4          low  4  1.2
5          low  5 26.5
6   medium-low  6  9.2
7   medium-low  7 36.5
8   medium-low  8 17.9
9   medium-low  9 18.0
10  medium-low 10 18.4
11 medium-high 11 -3.7
12 medium-high 12 13.7
13 medium-high 13 22.6
14 medium-high 14  4.4
15 medium-high 15 13.0
16        high 16 51.2
17        high 17 34.0
18        high 18 35.9
19        high 19 28.9
20        high 20 50.0
```
]
 
.panel3-tab-simdat3-auto[
データセット
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat3-auto[

```r
simdat3 |&gt;
* group_by(F)
```
]
 
.panel2-tab-simdat3-auto[

```
# A tibble: 20 x 3
# Groups:   F [4]
   F           id       DV
   &lt;fct&gt;       &lt;fct&gt; &lt;dbl&gt;
 1 low         1      3.57
 2 low         2     11.3 
 3 low         3      7.34
 4 low         4      1.22
 5 low         5     26.5 
 6 medium-low  6      9.24
 7 medium-low  7     36.5 
 8 medium-low  8     17.9 
 9 medium-low  9     18.0 
10 medium-low  10    18.4 
11 medium-high 11    -3.71
12 medium-high 12    13.7 
13 medium-high 13    22.6 
14 medium-high 14     4.44
15 medium-high 15    13.0 
16 high        16    51.2 
17 high        17    34.0 
18 high        18    35.9 
19 high        19    28.9 
20 high        20    50.0 
```
]
 
.panel3-tab-simdat3-auto[
説明変数の水準毎にデータをまとめ上げ
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
* summarise(
*   N = length(DV),
*   M = mean(DV),
*   SD = sd(DV),
*   SE = SD / sqrt(N)
* )
```
]
 
.panel2-tab-simdat3-auto[

```
# A tibble: 4 x 5
  F               N     M    SD    SE
  &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 low             5    10    10  4.47
2 medium-low      5    20    10  4.47
3 medium-high     5    10    10  4.47
4 high            5    40    10  4.47
```
]
 
.panel3-tab-simdat3-auto[
水準毎に，  
- データの個数**N**，  
- 応答変数の平均値**M**，  
- 応答変数の平均値の標準偏差**SD**，  
- 応答変数の平均値の標準偏差**SE**  
  
を計算
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
* ungroup()
```
]
 
.panel2-tab-simdat3-auto[

```
# A tibble: 4 x 5
  F               N     M    SD    SE
  &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 low             5    10    10  4.47
2 medium-low      5    20    10  4.47
3 medium-high     5    10    10  4.47
4 high            5    40    10  4.47
```
]
 
.panel3-tab-simdat3-auto[
まとめ上げを解除
]

---
count: false
 
### シミュレーションの結果を図や表で確認
.panel1-tab-simdat3-auto[

```r
simdat3 |&gt;
  group_by(F) |&gt;
  summarise(
    N = length(DV),
    M = mean(DV),
    SD = sd(DV),
    SE = SD / sqrt(N)
  ) |&gt;
  ungroup() |&gt;
* kable(
*   digits = 2,
*   col.names = c(
*     'Levels of Factor',
*     'N. of data points',
*     'Mean RT',
*     'Std. Dev.',
*     'Std. Err.'
*   )
* )
```
]
 
.panel2-tab-simdat3-auto[

|Levels of Factor | N. of data points| Mean RT| Std. Dev.| Std. Err.|
|:----------------|-----------------:|-------:|---------:|---------:|
|low              |                 5|      10|        10|       4.5|
|medium-low       |                 5|      20|        10|       4.5|
|medium-high      |                 5|      10|        10|       4.5|
|high             |                 5|      40|        10|       4.5|
]
 
.panel3-tab-simdat3-auto[
表の出力  
- **digits**：有効数字の桁数を指定  
- **col.names**：表内での各列の名前を変更
]

&lt;style&gt;
.panel1-tab-simdat3-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-tab-simdat3-auto {
  color: black;
  width: 38.8%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-tab-simdat3-auto {
  color: black;
  width: 19.4%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---


name: repeated-contrast-weights

## Repeated contrasts

::: columns

:::: pull-left

- （順序が決まっている）隣り合う水準同士を比較
  - 実験群1 vs 実験群2
  - 実験群2 vs 実験群3
  - 実験群3 vs 実験群4...

--

- 例：語の頻度の効果を，隣り合う水準と比べる
    1. 低頻度
    2. 中頻度・低
    3. 中頻度・高
    4. 高頻度

--

  - 主な対比は次の3つ
      1. 中頻度・低のRT &lt; 低頻度のRT
      2. 中頻度・高のRT &lt; 中頻度・低のRT
      3. 高頻度のRT &lt; 中頻度・高のRT

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-simdat3-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Repeated contrasts

::: columns

:::: pull-left

::::: block

### 検証する帰無仮説

1. 中頻度・低のRT `\(\mu_2\)` は，低頻度語へのRT `\(\mu_1\)` と同じか？
2. 中頻度・高のRT `\(\mu_3\)` は，中頻度・低のRT `\(\mu_2\)` と同じか？
3. 高頻度のRT `\(\mu_4\)` は， 中頻度・高のRT `\(\mu_3\)` と同じか？

&lt;!--
4. 全体平均 `\(\frac{\mu_1 + \mu_2 + \mu_3 + \mu_4}{4}\)` は0秒と同じ？
--&gt;

:::::

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-69-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Repeated contrasts

::: columns

:::: pull-left

::::: block

### 検証する帰無仮説

言葉を数式に変換

`$$\begin{aligned}
{H_0}_{2-1}: &amp; \mu_2 = \mu_1 \\
{H_0}_{3-2}: &amp; \mu_3 = \mu_2 \\
{H_0}_{4-3}: &amp; \mu_4 = \mu_3
\end{aligned}$$`

:::::

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-70-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Repeated contrasts

::: columns

:::: pull-left

::::: block

### 検証する帰無仮説

両辺から右辺部分を引く

`$$\begin{aligned}
{H_0}_{2-1}: &amp; \mu_2 - \mu_1 = 0 \\
{H_0}_{3-2}: &amp; \mu_3 - \mu_2 = 0 \\
{H_0}_{4-3}: &amp; \mu_4 - \mu_3 = 0
\end{aligned}$$`

:::::

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-71-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Repeated contrasts

::: columns

:::: pull-left

::::: block

### 検証する帰無仮説

- `\(\mu_1, ..., \mu_4\)` の内，各式に存在しないものを書き加える
- 書き加えるときには，追加するものに0を掛けてから

`$$\begin{aligned}
{H_0}_{2-1}: &amp; \mu_2 - \mu_1 + 0 \times \mu_3 + 0 \times \mu_4 = 0 \\
{H_0}_{3-2}: &amp; \mu_3 - \mu_2 + 0 \times \mu_1 + 0 \times \mu_4 = 0 \\
{H_0}_{4-3}: &amp; \mu_4 - \mu_3 + 0 \times \mu_1 + 0 \times \mu_2 = 0
\end{aligned}$$`

:::::

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-72-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Repeated contrasts

::: columns

:::: pull-left

::::: block

### 検証する帰無仮説

- `\(\mu_1, ..., \mu_4\)` の順番を整理
- `\(\mu_1, ..., \mu_4\)`に掛かっている数が，それぞれに対する重みづけ

`$$\begin{aligned}
{H_0}_{2-1}: &amp; (-1) \times \mu_1 + 1\times \mu_2 + 0 \times \mu_3 + 0 \times \mu_4 = 0 \\
{H_0}_{3-2}: &amp; 0 \times \mu_1 + (-1) \times \mu_2 + 1 \times \mu_3 + 0 \times \mu_4 = 0 \\
{H_0}_{4-3}: &amp; 0 \times \mu_1 + 0 \times \mu_2 + (-1) \times \mu_3 + 1 \times \mu_4= 0
\end{aligned}$$`

:::::

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-73-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## 重みづけを抽出し，「仮説行列」に書く

`\(\mu_1\)`, `\(\mu_2\)`, `\(\mu_3\)`, `\(\mu_4\)` には重みづけがある

::: columns

:::: pull-left

`$$\begin{aligned}
{H_0}_{2-1}: &amp; (-1) \times \mu_1 + 1\times \mu_2 + 0 \times \mu_3 + 0 \times \mu_4 = 0 \\
{H_0}_{3-2}: &amp; 0 \times \mu_1 + (-1) \times \mu_2 + 1 \times \mu_3 + 0 \times \mu_4 = 0 \\
{H_0}_{4-3}: &amp; 0 \times \mu_1 + 0 \times \mu_2 + (-1) \times \mu_3 + 1 \times \mu_4= 0
\end{aligned}$$`

::::

:::: pull-right

- 各行：**帰無仮説**
  - `\({H_0}_{2-1}\)`: `c2vs1`
  - `\({H_0}_{3-2}\)`: `c3vs2`
  - `\({H_0}_{4-3}\)`: `c4vs3`
- 各列：各水準への**重み**


```r
HcRE &lt;- rbind(
  c2vs1 = c(low = -1, `med-low` =  1, `med-hi` =  0, hi = 0),
  c3vs2 = c(low =  0, `med-low` = -1, `med-hi` =  1, hi = 0),
  c4vs3 = c(low =  0, `med-low` =  0, `med-hi` = -1, hi = 1)
)
```



::::

:::

---

count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-repeated-hypothesis-matrix-transpose-auto[

```r
*HcRE
```
]
 
.panel2-repeated-hypothesis-matrix-transpose-auto[

```
      low med-low med-hi hi
c2vs1  -1       1      0  0
c3vs2   0      -1      1  0
c4vs3   0       0     -1  1
```
]
 
.panel3-repeated-hypothesis-matrix-transpose-auto[
仮説行列
]

---
count: false
 
## 重みづけを抽出し，「仮説行列」に書く
.panel1-repeated-hypothesis-matrix-transpose-auto[

```r
HcRE |&gt;
* t()
```
]
 
.panel2-repeated-hypothesis-matrix-transpose-auto[

```
        c2vs1 c3vs2 c4vs3
low        -1     0     0
med-low     1    -1     0
med-hi      0     1    -1
hi          0     0     1
```
]
 
.panel3-repeated-hypothesis-matrix-transpose-auto[
仮説行列を転置 *transpose*  
今度は各行が水準，各列が仮説に変わる
]

&lt;style&gt;
.panel1-repeated-hypothesis-matrix-transpose-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-repeated-hypothesis-matrix-transpose-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-repeated-hypothesis-matrix-transpose-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-auto[

```r
*XcRE &lt;- HcRE

XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-auto[

```
      low med-low med-hi hi
c2vs1  -1       1      0  0
c3vs2   0      -1      1  0
c4vs3   0       0     -1  1
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-auto[
仮説行列に対し…
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-auto[

```r
XcRE &lt;- HcRE |&gt;
* hypr::ginv2()

XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-auto[

```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-auto[
一般化逆行列を適用，仮説行列を対比行列に変換
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-auto[

```r
XcRE &lt;- HcRE |&gt;
  hypr::ginv2()

*XcRE &lt;- HcRE

XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-auto[

```
      low med-low med-hi hi
c2vs1  -1       1      0  0
c3vs2   0      -1      1  0
c4vs3   0       0     -1  1
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-auto[
仮説行列に対し…
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-auto[

```r
XcRE &lt;- HcRE |&gt;
  hypr::ginv2()

XcRE &lt;- HcRE |&gt;
* ginv()

XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-auto[

```
      [,1] [,2]  [,3]
[1,] -0.75 -0.5 -0.25
[2,]  0.25 -0.5 -0.25
[3,]  0.25  0.5 -0.25
[4,]  0.25  0.5  0.75
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-auto[
一般化逆行列を適用，仮説行列を対比行列に変換
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-auto[

```r
XcRE &lt;- HcRE |&gt;
  hypr::ginv2()

XcRE &lt;- HcRE |&gt;
  ginv() |&gt;
* provideDimnames(
*   base = dimnames(HcRE)[2:1]
* )

XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-auto[

```
        c2vs1 c3vs2 c4vs3
low     -0.75  -0.5 -0.25
med-low  0.25  -0.5 -0.25
med-hi   0.25   0.5 -0.25
hi       0.25   0.5  0.75
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-auto[
行名・列名を再付与
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-auto[

```r
XcRE &lt;- HcRE |&gt;
  hypr::ginv2()

XcRE &lt;- HcRE |&gt;
  ginv() |&gt;
  provideDimnames(
    base = dimnames(HcRE)[2:1]
  ) |&gt;
* fractions()

XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-auto[

```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-auto[
分数表記に
]

&lt;style&gt;
.panel1-repeated-hypothesis-matrix-ginv-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-repeated-hypothesis-matrix-ginv-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-repeated-hypothesis-matrix-ginv-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-contr-sdif-auto[

```r
*XcRE
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-contr-sdif-auto[

```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-contr-sdif-auto[
仮説行列に一般化逆行列を適用したもの
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-contr-sdif-auto[

```r
XcRE

*contr.sdif(4)
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-contr-sdif-auto[

```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```

```
    2-1  3-2   4-3
1 -0.75 -0.5 -0.25
2  0.25 -0.5 -0.25
3  0.25  0.5 -0.25
4  0.25  0.5  0.75
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-contr-sdif-auto[
4水準の時のrepeated contrast
]

---
count: false
 
## 一般化逆行列を使い，仮説行列を対比行列に変換
.panel1-repeated-hypothesis-matrix-ginv-contr-sdif-auto[

```r
XcRE

contr.sdif(4) |&gt;
* fractions()
```
]
 
.panel2-repeated-hypothesis-matrix-ginv-contr-sdif-auto[

```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```

```
  2-1  3-2  4-3 
1 -3/4 -1/2 -1/4
2  1/4 -1/2 -1/4
3  1/4  1/2 -1/4
4  1/4  1/2  3/4
```
]
 
.panel3-repeated-hypothesis-matrix-ginv-contr-sdif-auto[
分数表記に
]

&lt;style&gt;
.panel1-repeated-hypothesis-matrix-ginv-contr-sdif-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-repeated-hypothesis-matrix-ginv-contr-sdif-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-repeated-hypothesis-matrix-ginv-contr-sdif-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-repeated-contrasts-rotate[

```r
*contrasts(simdat3$F) &lt;- contr.sdif(4) |&gt; fractions()

contrasts(simdat3$F)

lm(DV ~ F, data = simdat3) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(2),
      ", ",
      conf.high |&gt; round(2),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```
]
 
.panel2-manual-repeated-contrasts-rotate[

```
            2-1  3-2  4-3 
low         -3/4 -1/2 -1/4
medium-low   1/4 -1/2 -1/4
medium-high  1/4  1/2 -1/4
high         1/4  1/2  3/4
```



|Predictor   | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------------|---------:|---------:|
|(Intercept) |       20|[15.26, 24.74] |       8.9|      0.00|
|F2-1        |       10|[-3.41, 23.41] |       1.6|      0.13|
|F3-2        |      -10|[-23.41, 3.41] |      -1.6|      0.13|
|F4-3        |       30|[16.59, 43.41] |       4.7|      0.00|
]
 
.panel3-manual-repeated-contrasts-rotate[
**contr.sdif(3)**で作ったrepeated contrastsを適用
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-repeated-contrasts-rotate[

```r
*contrasts(simdat3$F) &lt;- XcRE

contrasts(simdat3$F)

lm(DV ~ F, data = simdat3) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(2),
      ", ",
      conf.high |&gt; round(2),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```
]
 
.panel2-manual-repeated-contrasts-rotate[

```
            c2vs1 c3vs2 c4vs3
low         -3/4  -1/2  -1/4 
medium-low   1/4  -1/2  -1/4 
medium-high  1/4   1/2  -1/4 
high         1/4   1/2   3/4 
```



|Predictor   | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------------|---------:|---------:|
|(Intercept) |       20|[15.26, 24.74] |       8.9|      0.00|
|Fc2vs1      |       10|[-3.41, 23.41] |       1.6|      0.13|
|Fc3vs2      |      -10|[-23.41, 3.41] |      -1.6|      0.13|
|Fc4vs3      |       30|[16.59, 43.41] |       4.7|      0.00|
]
 
.panel3-manual-repeated-contrasts-rotate[
仮説行列から作ったrepeated contrastsを適用
]

&lt;style&gt;
.panel1-manual-repeated-contrasts-rotate {
  color: black;
  width: 48.5%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-manual-repeated-contrasts-rotate {
  color: black;
  width: 32.3333333333333%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-manual-repeated-contrasts-rotate {
  color: black;
  width: 16.1666666666667%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## 統計モデルから仮説を検証

::: columns

:::: pull-left

::::: block

&lt;!--
### 検証する帰無仮説
--&gt;

1. 中頻度・低のRT `\(\mu_2\)` は，低頻度語へのRT `\(\mu_1\)` と同じか？
    - `Fc2vs1`より， `\(\mu_2 - \mu_1 = 10\)`
    - `\(t\)` 値が `\(t(16)\)` の両側2.5% `\(t \leq -2.12, 2.12 \leq t\)`にないため，中頻度・低へのRTは低頻度語へのRTより有意に長いとは言えない
2. 中頻度・高へのRT `\(\mu_3\)` は，中頻度・低へのRT `\(\mu_2\)` と同じか？
    - `Fc3vs2`より， `\(\mu_3 - \mu_2 = -10\)`
    - `\(t\)` 値が `\(t(16)\)` の両側2.5%にないため，中頻度・高へのRTは中頻度・低へのRTより有意に長いとは言えない
3. 高頻度へのRT `\(\mu_4\)` は， 中頻度・高のRT `\(\mu_3\)` と同じか？
    - `Fc4vs3`より， `\(\mu_4 - \mu_3 = 30\)`
    - `\(t\)` 値が `\(t(16)\)` の両側2.5%にあるため，高頻度へのRTは中頻度・高へのRTより有意に長い

:::::

::::

:::: pull-right


```
            c2vs1 c3vs2 c4vs3
low         -3/4  -1/2  -1/4 
medium-low   1/4  -1/2  -1/4 
medium-high  1/4   1/2  -1/4 
high         1/4   1/2   3/4 
```



|Predictor   | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------------|---------:|---------:|
|(Intercept) |       20|[15.26, 24.74] |       8.9|      0.00|
|Fc2vs1      |       10|[-3.41, 23.41] |       1.6|      0.13|
|Fc3vs2      |      -10|[-23.41, 3.41] |      -1.6|      0.13|
|Fc4vs3      |       30|[16.59, 43.41] |       4.7|      0.00|

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-81-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---


## Contrasts in linear regression analysis: The design or model matrix

- 質的変数の対比により，離散的な水準を数値の変数にする
  - 離散的：とびとびの値を取る
- どの水準間の差について検定しようとしているか，数値・数式として符号する

---

## Contrast matrix 対比行列

それぞれの水準をどのようにコーディングしたか，1行ずつ記述したもの


```r
XcRE
```


```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```

---

count: false
 
## Design matrix [配置行列](https://www.ouj.ac.jp/mijika/tokei/xml/k3_04012.xml)  
  
各データポイントに対し，具体的にどの対比が使われたか記述したもの  

.panel1-repeated-contrast-design-matrix-auto[

```r
*covars &lt;- model.matrix(
* ~ 1 + F, data = simdat3
*) 
```
]
 
.panel2-repeated-contrast-design-matrix-auto[

]
 
.panel3-repeated-contrast-design-matrix-auto[
配置行列のオブジェクトを作る
]

---
count: false
 
## Design matrix [配置行列](https://www.ouj.ac.jp/mijika/tokei/xml/k3_04012.xml)  
  
各データポイントに対し，具体的にどの対比が使われたか記述したもの  

.panel1-repeated-contrast-design-matrix-auto[

```r
covars &lt;- model.matrix(
  ~ 1 + F, data = simdat3
) |&gt;
* as_tibble()
```
]
 
.panel2-repeated-contrast-design-matrix-auto[

]
 
.panel3-repeated-contrast-design-matrix-auto[
tibbleデータフレームにする
]

---
count: false
 
## Design matrix [配置行列](https://www.ouj.ac.jp/mijika/tokei/xml/k3_04012.xml)  
  
各データポイントに対し，具体的にどの対比が使われたか記述したもの  

.panel1-repeated-contrast-design-matrix-auto[

```r
covars &lt;- model.matrix(
  ~ 1 + F, data = simdat3
) |&gt;
  as_tibble()

*covars
```
]
 
.panel2-repeated-contrast-design-matrix-auto[

```
# A tibble: 20 x 4
   `(Intercept)` Fc2vs1 Fc3vs2 Fc4vs3
           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1             1 -0.75  -0.5    -0.25
 2             1 -0.75  -0.5    -0.25
 3             1 -0.75  -0.5    -0.25
 4             1 -0.75  -0.5    -0.25
 5             1 -0.75  -0.5    -0.25
 6             1  0.250 -0.5    -0.25
 7             1  0.250 -0.5    -0.25
 8             1  0.250 -0.5    -0.25
 9             1  0.250 -0.5    -0.25
10             1  0.250 -0.5    -0.25
11             1  0.250  0.500  -0.25
12             1  0.250  0.500  -0.25
13             1  0.250  0.500  -0.25
14             1  0.250  0.500  -0.25
15             1  0.250  0.500  -0.25
16             1  0.25   0.5     0.75
17             1  0.25   0.5     0.75
18             1  0.25   0.5     0.75
19             1  0.25   0.5     0.75
20             1  0.25   0.5     0.75
```
]
 
.panel3-repeated-contrast-design-matrix-auto[

]

&lt;style&gt;
.panel1-repeated-contrast-design-matrix-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-repeated-contrast-design-matrix-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-repeated-contrast-design-matrix-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---


.pull-left[

### Contrast matrix 対比行列


```
        c2vs1 c3vs2 c4vs3
low     -3/4  -1/2  -1/4 
med-low  1/4  -1/2  -1/4 
med-hi   1/4   1/2  -1/4 
hi       1/4   1/2   3/4 
```

]

.pull-right[

### Design matrix 配置行列

- 対比行列を各データポイントに拡張したもの
- どのデータポイントに，どの水準（コーディング）が**配置**されているか示す
- `Fc2vs1`のような列は，「質的変数の各水準を，1つずつ量的な説明変数に替えたもの」

&lt;!--
"元データ", "要因**F**の列だけ抽出", "要因**F**の列と**covars**を結合する", "**F**を**(Intercept)**の後ろに"
--&gt;


```
   (Intercept)           F Fc2vs1 Fc3vs2 Fc4vs3
1            1         low  -0.75   -0.5  -0.25
2            1         low  -0.75   -0.5  -0.25
3            1         low  -0.75   -0.5  -0.25
4            1         low  -0.75   -0.5  -0.25
5            1         low  -0.75   -0.5  -0.25
6            1  medium-low   0.25   -0.5  -0.25
7            1  medium-low   0.25   -0.5  -0.25
8            1  medium-low   0.25   -0.5  -0.25
9            1  medium-low   0.25   -0.5  -0.25
10           1  medium-low   0.25   -0.5  -0.25
11           1 medium-high   0.25    0.5  -0.25
12           1 medium-high   0.25    0.5  -0.25
13           1 medium-high   0.25    0.5  -0.25
14           1 medium-high   0.25    0.5  -0.25
15           1 medium-high   0.25    0.5  -0.25
```

]

---

## Design matrixを線形モデルの要因として使う

Design matrixにおける`Fc2vs1`のような列は，「質的変数の各水準を，1つずつの量的な説明変数に替えたもの」

- `Fc2vs1`などを「『質的な説明変数』の水準」の1つではなく，「量的な説明変数」の1つとして捉える
  - `Fc2vs1`は，質的な説明変数`F`の水準の1つ
  - `Fc2vs1`は，量的な説明変数`Fc2vs1`であり， `\(-\frac{3}{4}\)` または `\(\frac{1}{4}\)`を取る

**Design matrixにおける`Fc2vs1`などを説明変数として利用できる**

---

count: false
 
## Design matrixを線形モデルの要因として使う  
  
Design matrixをsimdat3に結合  

.panel1-simdat3-with-repeated-contrast-design-matrix-auto[

```r
*simdat3_DM &lt;- covars

simdat3_DM
```
]
 
.panel2-simdat3-with-repeated-contrast-design-matrix-auto[

```
# A tibble: 20 x 4
   `(Intercept)` Fc2vs1 Fc3vs2 Fc4vs3
           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1             1 -0.75  -0.5    -0.25
 2             1 -0.75  -0.5    -0.25
 3             1 -0.75  -0.5    -0.25
 4             1 -0.75  -0.5    -0.25
 5             1 -0.75  -0.5    -0.25
 6             1  0.250 -0.5    -0.25
 7             1  0.250 -0.5    -0.25
 8             1  0.250 -0.5    -0.25
 9             1  0.250 -0.5    -0.25
10             1  0.250 -0.5    -0.25
11             1  0.250  0.500  -0.25
12             1  0.250  0.500  -0.25
13             1  0.250  0.500  -0.25
14             1  0.250  0.500  -0.25
15             1  0.250  0.500  -0.25
16             1  0.25   0.5     0.75
17             1  0.25   0.5     0.75
18             1  0.25   0.5     0.75
19             1  0.25   0.5     0.75
20             1  0.25   0.5     0.75
```
]
 
.panel3-simdat3-with-repeated-contrast-design-matrix-auto[
配置行列のオブジェクト
]

---
count: false
 
## Design matrixを線形モデルの要因として使う  
  
Design matrixをsimdat3に結合  

.panel1-simdat3-with-repeated-contrast-design-matrix-auto[

```r
simdat3_DM &lt;- covars |&gt;
* dplyr::select(-`(Intercept)`)

simdat3_DM
```
]
 
.panel2-simdat3-with-repeated-contrast-design-matrix-auto[

```
# A tibble: 20 x 3
   Fc2vs1 Fc3vs2 Fc4vs3
    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.75  -0.5    -0.25
 2 -0.75  -0.5    -0.25
 3 -0.75  -0.5    -0.25
 4 -0.75  -0.5    -0.25
 5 -0.75  -0.5    -0.25
 6  0.250 -0.5    -0.25
 7  0.250 -0.5    -0.25
 8  0.250 -0.5    -0.25
 9  0.250 -0.5    -0.25
10  0.250 -0.5    -0.25
11  0.250  0.500  -0.25
12  0.250  0.500  -0.25
13  0.250  0.500  -0.25
14  0.250  0.500  -0.25
15  0.250  0.500  -0.25
16  0.25   0.5     0.75
17  0.25   0.5     0.75
18  0.25   0.5     0.75
19  0.25   0.5     0.75
20  0.25   0.5     0.75
```
]
 
.panel3-simdat3-with-repeated-contrast-design-matrix-auto[
**(Intercept)**列を除去
]

---
count: false
 
## Design matrixを線形モデルの要因として使う  
  
Design matrixをsimdat3に結合  

.panel1-simdat3-with-repeated-contrast-design-matrix-auto[

```r
simdat3_DM &lt;- covars |&gt;
  dplyr::select(-`(Intercept)`) |&gt;
* bind_cols(simdat3)

simdat3_DM
```
]
 
.panel2-simdat3-with-repeated-contrast-design-matrix-auto[

```
# A tibble: 20 x 6
   Fc2vs1 Fc3vs2 Fc4vs3 F           id       DV
    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt; &lt;dbl&gt;
 1 -0.75  -0.5    -0.25 low         1      3.57
 2 -0.75  -0.5    -0.25 low         2     11.3 
 3 -0.75  -0.5    -0.25 low         3      7.34
 4 -0.75  -0.5    -0.25 low         4      1.22
 5 -0.75  -0.5    -0.25 low         5     26.5 
 6  0.250 -0.5    -0.25 medium-low  6      9.24
 7  0.250 -0.5    -0.25 medium-low  7     36.5 
 8  0.250 -0.5    -0.25 medium-low  8     17.9 
 9  0.250 -0.5    -0.25 medium-low  9     18.0 
10  0.250 -0.5    -0.25 medium-low  10    18.4 
11  0.250  0.500  -0.25 medium-high 11    -3.71
12  0.250  0.500  -0.25 medium-high 12    13.7 
13  0.250  0.500  -0.25 medium-high 13    22.6 
14  0.250  0.500  -0.25 medium-high 14     4.44
15  0.250  0.500  -0.25 medium-high 15    13.0 
16  0.25   0.5     0.75 high        16    51.2 
17  0.25   0.5     0.75 high        17    34.0 
18  0.25   0.5     0.75 high        18    35.9 
19  0.25   0.5     0.75 high        19    28.9 
20  0.25   0.5     0.75 high        20    50.0 
```
]
 
.panel3-simdat3-with-repeated-contrast-design-matrix-auto[
**(Intercept)**列を除去した配置行列を，**simdat3**に結合
]

---
count: false
 
## Design matrixを線形モデルの要因として使う  
  
Design matrixをsimdat3に結合  

.panel1-simdat3-with-repeated-contrast-design-matrix-auto[

```r
simdat3_DM &lt;- covars |&gt;
  dplyr::select(-`(Intercept)`) |&gt;
  bind_cols(simdat3) |&gt;
* relocate(F)

simdat3_DM
```
]
 
.panel2-simdat3-with-repeated-contrast-design-matrix-auto[

```
# A tibble: 20 x 6
   F           Fc2vs1 Fc3vs2 Fc4vs3 id       DV
   &lt;fct&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;
 1 low         -0.75  -0.5    -0.25 1      3.57
 2 low         -0.75  -0.5    -0.25 2     11.3 
 3 low         -0.75  -0.5    -0.25 3      7.34
 4 low         -0.75  -0.5    -0.25 4      1.22
 5 low         -0.75  -0.5    -0.25 5     26.5 
 6 medium-low   0.250 -0.5    -0.25 6      9.24
 7 medium-low   0.250 -0.5    -0.25 7     36.5 
 8 medium-low   0.250 -0.5    -0.25 8     17.9 
 9 medium-low   0.250 -0.5    -0.25 9     18.0 
10 medium-low   0.250 -0.5    -0.25 10    18.4 
11 medium-high  0.250  0.500  -0.25 11    -3.71
12 medium-high  0.250  0.500  -0.25 12    13.7 
13 medium-high  0.250  0.500  -0.25 13    22.6 
14 medium-high  0.250  0.500  -0.25 14     4.44
15 medium-high  0.250  0.500  -0.25 15    13.0 
16 high         0.25   0.5     0.75 16    51.2 
17 high         0.25   0.5     0.75 17    34.0 
18 high         0.25   0.5     0.75 18    35.9 
19 high         0.25   0.5     0.75 19    28.9 
20 high         0.25   0.5     0.75 20    50.0 
```
]
 
.panel3-simdat3-with-repeated-contrast-design-matrix-auto[
**F**列が最先頭列になるよう列を並べ替え
]

&lt;style&gt;
.panel1-simdat3-with-repeated-contrast-design-matrix-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-simdat3-with-repeated-contrast-design-matrix-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-simdat3-with-repeated-contrast-design-matrix-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;




---

count: false
 
## Design matrixを線形モデルの要因として使う
.panel1-lm-with-repeated-contrast-design-matrix-rotate[

```r
*m3_mr &lt;- lm(DV ~ F, data = simdat3_DM)

m3_mr |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(2),
      ", ",
      conf.high |&gt; round(2),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```
]
 
.panel2-lm-with-repeated-contrast-design-matrix-rotate[

|Predictor   | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------------|---------:|---------:|
|(Intercept) |       20|[15.26, 24.74] |       8.9|      0.00|
|Fc2vs1      |       10|[-3.41, 23.41] |       1.6|      0.13|
|Fc3vs2      |      -10|[-23.41, 3.41] |      -1.6|      0.13|
|Fc4vs3      |       30|[16.59, 43.41] |       4.7|      0.00|
]
 
.panel3-lm-with-repeated-contrast-design-matrix-rotate[
Repeated contrastを適用した**F**を使いモデルを構築した場合
]

---
count: false
 
## Design matrixを線形モデルの要因として使う
.panel1-lm-with-repeated-contrast-design-matrix-rotate[

```r
*m3_mr &lt;- lm(DV ~ Fc2vs1 + Fc3vs2 + Fc4vs3, data = simdat3_DM)

m3_mr |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(2),
      ", ",
      conf.high |&gt; round(2),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
  kable(
    digits = 2,
    escape = FALSE,
    col.names = c(
      'Predictor',
      'Estimate',
      '95% CI',
      '$t$-value',
      '$p$-value'
    )
  )
```
]
 
.panel2-lm-with-repeated-contrast-design-matrix-rotate[

|Predictor   | Estimate|95% CI         | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------------|---------:|---------:|
|(Intercept) |       20|[15.26, 24.74] |       8.9|      0.00|
|Fc2vs1      |       10|[-3.41, 23.41] |       1.6|      0.13|
|Fc3vs2      |      -10|[-23.41, 3.41] |      -1.6|      0.13|
|Fc4vs3      |       30|[16.59, 43.41] |       4.7|      0.00|
]
 
.panel3-lm-with-repeated-contrast-design-matrix-rotate[
Repeated contrastに基づくdesign matrixを使いモデルを構築した場合  
  
**Repeated contrastを適用したFを使いモデルを構築した場合と結果が完全に一致！**
]

&lt;style&gt;
.panel1-lm-with-repeated-contrast-design-matrix-rotate {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-lm-with-repeated-contrast-design-matrix-rotate {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-lm-with-repeated-contrast-design-matrix-rotate {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---



---


name: polynomial-contrast-weights

## Polynomial contrasts

::: columns

:::: pull-left

- （順序が決まっている）隣り合う水準同士を比較
  - 水準間で同じペースで増加・減少？
  - 水準間毎に，増加・減少のペースが変わる？
- 例：語の頻度の効果を，隣り合う水準と比べる
    1. 低頻度
    2. 中頻度・低
    3. 中頻度・高
    4. 高頻度
- 主な対比は次の3つ
    1. 1次関数ペース（Linear; どの水準間でも一定ペースで増加・減少？）
    2. 2次関数ペース（Quadratic; 次の水準間に移るほど増加・減少が激しい・穏やか？）
    3. 3次関数ペース（Cubic; 次の水準間に移るほど増加・減少が入れ替わる？）

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-schema-simdat3-polynomial-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Polynomial contrasts

::: columns

:::: pull-left

::::: block

### 検証する帰無仮説

1. 1次関数ペース（Linear; どの水準間でも一定ペースで増加・減少？）
2. 2次関数ペース（Quadratic; 次の水準間に移るほど増加・減少が激しい・穏やか？）
3. 3次関数ペース（Cubic; 次の水準間に移るほど増加・減少が入れ替わる？）

:::::

::::

:::: pull-right

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-90-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

count: false
 
## Polynomial contrastの対比行列
.panel1-polynomial-hypothesis-matrix-ginv-contr-poly-auto[

```r
*contrasts(simdat3$F) &lt;- contr.poly(4)
```
]
 
.panel2-polynomial-hypothesis-matrix-ginv-contr-poly-auto[

]
 
.panel3-polynomial-hypothesis-matrix-ginv-contr-poly-auto[
4水準の時のPolynomial contrastの対比行列
]

---
count: false
 
## Polynomial contrastの対比行列
.panel1-polynomial-hypothesis-matrix-ginv-contr-poly-auto[

```r
contrasts(simdat3$F) &lt;- contr.poly(4)
*contrasts(simdat3$F)
```
]
 
.panel2-polynomial-hypothesis-matrix-ginv-contr-poly-auto[

```
               .L   .Q    .C
low         -0.67  0.5 -0.22
medium-low  -0.22 -0.5  0.67
medium-high  0.22 -0.5 -0.67
high         0.67  0.5  0.22
```
]
 
.panel3-polynomial-hypothesis-matrix-ginv-contr-poly-auto[
希望するcontrastsになったか確認
]

&lt;style&gt;
.panel1-polynomial-hypothesis-matrix-ginv-contr-poly-auto {
  color: black;
  width: 28.7040816326531%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-polynomial-hypothesis-matrix-ginv-contr-poly-auto {
  color: black;
  width: 38.6020408163265%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-polynomial-hypothesis-matrix-ginv-contr-poly-auto {
  color: black;
  width: 29.6938775510204%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---

count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-polynomial-contrasts-auto[

```r
*lm(DV ~ F, data = simdat3)
```
]
 
.panel2-manual-polynomial-contrasts-auto[

```

Call:
lm(formula = DV ~ F, data = simdat3)

Coefficients:
(Intercept)          F.L          F.Q          F.C  
       20.0         17.9         10.0         13.4  
```
]
 
.panel3-manual-polynomial-contrasts-auto[
統計モデル構築
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-polynomial-contrasts-auto[

```r
lm(DV ~ F, data = simdat3) |&gt;
* tidy(conf.int = TRUE, conf.level = 0.95)
```
]
 
.panel2-manual-polynomial-contrasts-auto[

```
# A tibble: 4 x 7
  term        estimate std.error statistic     p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)     20        2.24      8.94 0.000000127   15.3        24.7
2 F.L             17.9      4.47      4    0.00103        8.41       27.4
3 F.Q             10        4.47      2.24 0.0399         0.519      19.5
4 F.C             13.4      4.47      3    0.00848        3.94       22.9
```
]
 
.panel3-manual-polynomial-contrasts-auto[
結果表示（各係数の95%信頼区間も算出）
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-polynomial-contrasts-auto[

```r
lm(DV ~ F, data = simdat3) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
* mutate(
*   `95% CI` = paste0(
*     "[",
*     conf.low |&gt; round(0),
*     ", ",
*     conf.high |&gt; round(0),
*     "]"
*   )
* )
```
]
 
.panel2-manual-polynomial-contrasts-auto[

```
# A tibble: 4 x 8
  term        estimate std.error statistic   p.value conf.low conf.high `95% CI`
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   
1 (Intercept)     20        2.24      8.94   1.27e-7   15.3        24.7 [15, 25]
2 F.L             17.9      4.47      4      1.03e-3    8.41       27.4 [8, 27] 
3 F.Q             10        4.47      2.24   3.99e-2    0.519      19.5 [1, 19] 
4 F.C             13.4      4.47      3      8.48e-3    3.94       22.9 [4, 23] 
```
]
 
.panel3-manual-polynomial-contrasts-auto[
各係数の95%信頼区間を1列にまとめる
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-polynomial-contrasts-auto[

```r
lm(DV ~ F, data = simdat3) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(0),
      ", ",
      conf.high |&gt; round(0),
      "]"
    )
  ) |&gt;
* relocate(`95% CI`, .after = estimate)
```
]
 
.panel2-manual-polynomial-contrasts-auto[

```
# A tibble: 4 x 8
  term        estimate `95% CI` std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)     20   [15, 25]      2.24      8.94   1.27e-7   15.3        24.7
2 F.L             17.9 [8, 27]       4.47      4      1.03e-3    8.41       27.4
3 F.Q             10   [1, 19]       4.47      2.24   3.99e-2    0.519      19.5
4 F.C             13.4 [4, 23]       4.47      3      8.48e-3    3.94       22.9
```
]
 
.panel3-manual-polynomial-contrasts-auto[
各係数の95%信頼区間をまとめた列を，係数の列の後ろに配置
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-polynomial-contrasts-auto[

```r
lm(DV ~ F, data = simdat3) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(0),
      ", ",
      conf.high |&gt; round(0),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
* dplyr::select(-c(std.error, conf.low, conf.high))
```
]
 
.panel2-manual-polynomial-contrasts-auto[

```
# A tibble: 4 x 5
  term        estimate `95% CI` statistic     p.value
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1 (Intercept)     20   [15, 25]      8.94 0.000000127
2 F.L             17.9 [8, 27]       4    0.00103    
3 F.Q             10   [1, 19]       2.24 0.0399     
4 F.C             13.4 [4, 23]       3    0.00848    
```
]
 
.panel3-manual-polynomial-contrasts-auto[
標準誤差，95%信頼区間の上・下限の列を削除
]

---
count: false
 
## 対比行列を要因に当てはめ，線形モデルを実行
.panel1-manual-polynomial-contrasts-auto[

```r
lm(DV ~ F, data = simdat3) |&gt;
  tidy(conf.int = TRUE, conf.level = 0.95) |&gt;
  mutate(
    `95% CI` = paste0(
      "[",
      conf.low |&gt; round(0),
      ", ",
      conf.high |&gt; round(0),
      "]"
    )
  ) |&gt;
  relocate(`95% CI`, .after = estimate) |&gt;
  dplyr::select(-c(std.error, conf.low, conf.high)) |&gt;
* kable(
*   digits = 2,
*   escape = FALSE,
*   col.names = c(
*     'Predictor',
*     'Estimate',
*     '95% CI',
*     '$t$-value',
*     '$p$-value'
*   )
* )
```
]
 
.panel2-manual-polynomial-contrasts-auto[

|Predictor   | Estimate|95% CI   | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------|---------:|---------:|
|(Intercept) |       20|[15, 25] |       8.9|      0.00|
|F.L         |       18|[8, 27]  |       4.0|      0.00|
|F.Q         |       10|[1, 19]  |       2.2|      0.04|
|F.C         |       13|[4, 23]  |       3.0|      0.01|
]
 
.panel3-manual-polynomial-contrasts-auto[
表にまとめる
]

&lt;style&gt;
.panel1-manual-polynomial-contrasts-auto {
  color: black;
  width: 48.5%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-manual-polynomial-contrasts-auto {
  color: black;
  width: 32.3333333333333%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-manual-polynomial-contrasts-auto {
  color: black;
  width: 16.1666666666667%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---

## 統計モデルから仮説を検証

::: columns

:::: pull-left

::::: block

&lt;!--
### 検証する帰無仮説
--&gt;

1. 1次関数ペース（Linear; どの水準間でも一定ペースで増加・減少？）
    - `F L`より，linear trend 有意
2. 2次関数ペース（Quadratic; 次の水準間に移るほど増加・減少が激しい・穏やか？）
    - `F Q`より，quadratic trend 有意
3. 3次関数ペース（Cubic; 次の水準間に移るほど増加・減少が入れ替わる？）
    - `F C`より，cubic trend 有意

:::::

::::

:::: pull-right


|Predictor   | Estimate|95% CI   | `\(t\)`-value| `\(p\)`-value|
|:-----------|--------:|:--------|---------:|---------:|
|(Intercept) |       20|[15, 25] |       8.9|      0.00|
|F.L         |       18|[8, 27]  |       4.0|      0.00|
|F.Q         |       10|[1, 19]  |       2.2|      0.04|
|F.C         |       13|[4, 23]  |       3.0|      0.01|

&lt;img src="figures/Notes-Schad-etal-2020-unnamed-chunk-94-1.png" width="576" style="display: block; margin: auto;" /&gt;

::::

:::

---

## Polynomial contrastの長所

- Polynomial contrastでlinear trendを指定することで，全体的な増加傾向をlinear trendの係数として表現することができる
  - 全体的な増加傾向の検出力も上がる
  - （データに応じ，全体的な減少傾向もlinear trendの係数として表現可能なはず）
- 要因の水準が増えれば増えるほど，他の対比方法（コーディング方法）やオムニバスF検定よりも，polynomial contrastを使う時の方が，少ない変数で応答変数を説明できる
  - オムニバスF検定：全ての水準から2つ選んでできる水準の組み合わせ全てについて1回ずつ統計を掛ける

---

---

&lt;!-- adjust font size in this css code chunk, currently 80 --&gt;

&lt;style type="text/css"&gt;
.remark-code{line-height: 1.5; font-size: 80%}

@media print {
  .has-continuation {
    display: block;
  }
}

code.r.hljs.remark-code{
  position: relative;
  overflow-x: hidden;
}


code.r.hljs.remark-code:hover{
  overflow-x:visible;
  width: 500px;
  border-style: solid;
}

.highlight-last-item &gt; ul &gt; li, 
.highlight-last-item &gt; ol &gt; li {
  opacity: 0.5;
}

.highlight-last-item &gt; ul &gt; li:last-of-type,
.highlight-last-item &gt; ol &gt; li:last-of-type {
  opacity: 1;
}

.column:first-of-type {float:left}
.column:last-of-type {float:right}

.split-30 .column:first-of-type {width: 30%}
.split-30 .column:last-of-type {width: 70%}
.split-40 .column:first-of-type {width: 40%}
.split-40 .column:last-of-type {width: 60%}
.split-50 .column:first-of-type {width: 50%}
.split-50 .column:last-of-type {width: 50%}
.split-60 .column:first-of-type {width: 60%}
.split-60 .column:last-of-type {width: 40%}
.split-70 .column:first-of-type {width: 70%}
.split-70 .column:last-of-type {width: 30%}

.pull-right + * {
  clear: both;
}

.pull-right + * {
  clear: both;
}
&lt;/style&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "magula",
"highlightLanguage": "r",
"highlightLines": true,
"highlightSpans": false,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%/%total%",
"navigation": {
"scroll": false,
"touch": true,
"click": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<script src="doc-creation/assets/pandoc.js"></script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
